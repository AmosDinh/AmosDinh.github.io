<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
%2F%2F%20ADD%20YOUR%20CODE%20HERE%0A%2F%2F%20import%20'whatwg-fetch'%3B%0A%0A%2F*%0A%20*%20Copyright%20(c)%202022%2C%20Jeff%20Hlywa%20(jhlywa%40gmail.com)%0A%20*%20All%20rights%20reserved.%0A%20*%0A%20*%20Redistribution%20and%20use%20in%20source%20and%20binary%20forms%2C%20with%20or%20without%0A%20*%20modification%2C%20are%20permitted%20provided%20that%20the%20following%20conditions%20are%20met%3A%0A%20*%0A%20*%201.%20Redistributions%20of%20source%20code%20must%20retain%20the%20above%20copyright%20notice%2C%0A%20*%20%20%20%20this%20list%20of%20conditions%20and%20the%20following%20disclaimer.%0A%20*%202.%20Redistributions%20in%20binary%20form%20must%20reproduce%20the%20above%20copyright%20notice%2C%0A%20*%20%20%20%20this%20list%20of%20conditions%20and%20the%20following%20disclaimer%20in%20the%20documentation%0A%20*%20%20%20%20and%2For%20other%20materials%20provided%20with%20the%20distribution.%0A%20*%0A%20*%20THIS%20SOFTWARE%20IS%20PROVIDED%20BY%20THE%20COPYRIGHT%20HOLDERS%20AND%20CONTRIBUTORS%20%22AS%20IS%22%0A%20*%20AND%20ANY%20EXPRESS%20OR%20IMPLIED%20WARRANTIES%2C%20INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20THE%0A%20*%20IMPLIED%20WARRANTIES%20OF%20MERCHANTABILITY%20AND%20FITNESS%20FOR%20A%20PARTICULAR%20PURPOSE%0A%20*%20ARE%20DISCLAIMED.%20IN%20NO%20EVENT%20SHALL%20THE%20COPYRIGHT%20OWNER%20OR%20CONTRIBUTORS%20BE%0A%20*%20LIABLE%20FOR%20ANY%20DIRECT%2C%20INDIRECT%2C%20INCIDENTAL%2C%20SPECIAL%2C%20EXEMPLARY%2C%20OR%0A%20*%20CONSEQUENTIAL%20DAMAGES%20(INCLUDING%2C%20BUT%20NOT%20LIMITED%20TO%2C%20PROCUREMENT%20OF%0A%20*%20SUBSTITUTE%20GOODS%20OR%20SERVICES%3B%20LOSS%20OF%20USE%2C%20DATA%2C%20OR%20PROFITS%3B%20OR%20BUSINESS%0A%20*%20INTERRUPTION)%20HOWEVER%20CAUSED%20AND%20ON%20ANY%20THEORY%20OF%20LIABILITY%2C%20WHETHER%20IN%0A%20*%20CONTRACT%2C%20STRICT%20LIABILITY%2C%20OR%20TORT%20(INCLUDING%20NEGLIGENCE%20OR%20OTHERWISE)%0A%20*%20ARISING%20IN%20ANY%20WAY%20OUT%20OF%20THE%20USE%20OF%20THIS%20SOFTWARE%2C%20EVEN%20IF%20ADVISED%20OF%20THE%0A%20*%20POSSIBILITY%20OF%20SUCH%20DAMAGE.%0A%20*%0A%20*----------------------------------------------------------------------------*%2F%0A%0A%0Avar%20Chess%20%3D%20function%20(fen)%20%7B%0A%20%20%20%20var%20BLACK%20%3D%20'b'%0A%20%20%20%20var%20WHITE%20%3D%20'w'%0A%0A%20%20%20%20var%20EMPTY%20%3D%20-1%0A%0A%20%20%20%20var%20PAWN%20%3D%20'p'%0A%20%20%20%20var%20KNIGHT%20%3D%20'n'%0A%20%20%20%20var%20BISHOP%20%3D%20'b'%0A%20%20%20%20var%20ROOK%20%3D%20'r'%0A%20%20%20%20var%20QUEEN%20%3D%20'q'%0A%20%20%20%20var%20KING%20%3D%20'k'%0A%0A%20%20%20%20var%20SYMBOLS%20%3D%20'pnbrqkPNBRQK'%0A%0A%20%20%20%20var%20DEFAULT_POSITION%20%3D%0A%20%20%20%20%20%20'rnbqkbnr%2Fpppppppp%2F8%2F8%2F8%2F8%2FPPPPPPPP%2FRNBQKBNR%20w%20KQkq%20-%200%201'%0A%0A%20%20%20%20var%20TERMINATION_MARKERS%20%3D%20%5B'1-0'%2C%20'0-1'%2C%20'1%2F2-1%2F2'%2C%20'*'%5D%0A%0A%20%20%20%20var%20PAWN_OFFSETS%20%3D%20%7B%0A%20%20%20%20%20%20b%3A%20%5B16%2C%2032%2C%2017%2C%2015%5D%2C%0A%20%20%20%20%20%20w%3A%20%5B-16%2C%20-32%2C%20-17%2C%20-15%5D%2C%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20PIECE_OFFSETS%20%3D%20%7B%0A%20%20%20%20%20%20n%3A%20%5B-18%2C%20-33%2C%20-31%2C%20-14%2C%2018%2C%2033%2C%2031%2C%2014%5D%2C%0A%20%20%20%20%20%20b%3A%20%5B-17%2C%20-15%2C%2017%2C%2015%5D%2C%0A%20%20%20%20%20%20r%3A%20%5B-16%2C%201%2C%2016%2C%20-1%5D%2C%0A%20%20%20%20%20%20q%3A%20%5B-17%2C%20-16%2C%20-15%2C%201%2C%2017%2C%2016%2C%2015%2C%20-1%5D%2C%0A%20%20%20%20%20%20k%3A%20%5B-17%2C%20-16%2C%20-15%2C%201%2C%2017%2C%2016%2C%2015%2C%20-1%5D%2C%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20prettier-ignore%0A%20%20%20%20var%20ATTACKS%20%3D%20%5B%0A%20%20%20%20%20%2020%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C20%2C%200%2C%0A%20%20%20%20%20%20%200%2C20%2C%200%2C%200%2C%200%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C%200%2C%200%2C%200%2C20%2C%202%2C%2024%2C%20%202%2C20%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C%200%2C%200%2C%200%2C%202%2C53%2C%2056%2C%2053%2C%202%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%2024%2C24%2C24%2C24%2C24%2C24%2C56%2C%20%200%2C%2056%2C24%2C24%2C24%2C24%2C24%2C24%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C%200%2C%200%2C%200%2C%202%2C53%2C%2056%2C%2053%2C%202%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C%200%2C%200%2C%200%2C20%2C%202%2C%2024%2C%20%202%2C20%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%200%2C%0A%20%20%20%20%20%20%200%2C20%2C%200%2C%200%2C%200%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C%200%2C%200%2C%200%2C20%2C%200%2C%200%2C%0A%20%20%20%20%20%2020%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%2024%2C%20%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C20%0A%20%20%20%20%5D%3B%0A%0A%20%20%20%20%2F%2F%20prettier-ignore%0A%20%20%20%20var%20RAYS%20%3D%20%5B%0A%20%20%20%20%20%20%2017%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2016%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2015%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%2017%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2016%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2015%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%2017%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2016%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2015%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%20%200%2C%2017%2C%20%200%2C%20%200%2C%20%200%2C%2016%2C%20%200%2C%20%200%2C%20%200%2C%2015%2C%20%200%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2017%2C%20%200%2C%20%200%2C%2016%2C%20%200%2C%20%200%2C%2015%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2017%2C%20%200%2C%2016%2C%20%200%2C%2015%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%2017%2C%2016%2C%2015%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%201%2C%20%201%2C%20%201%2C%20%201%2C%20%201%2C%20%201%2C%20%201%2C%20%200%2C%20-1%2C%20-1%2C%20%20-1%2C-1%2C%20-1%2C%20-1%2C%20-1%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C-15%2C-16%2C-17%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C-15%2C%20%200%2C-16%2C%20%200%2C-17%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%20%200%2C%20%200%2C-15%2C%20%200%2C%20%200%2C-16%2C%20%200%2C%20%200%2C-17%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C%20%200%2C-15%2C%20%200%2C%20%200%2C%20%200%2C-16%2C%20%200%2C%20%200%2C%20%200%2C-17%2C%20%200%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C%20%200%2C-15%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C-16%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C-17%2C%20%200%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20%20%200%2C-15%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C-16%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C-17%2C%20%200%2C%200%2C%0A%20%20%20%20%20%20-15%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C-16%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C%20%200%2C-17%0A%20%20%20%20%5D%3B%0A%0A%20%20%20%20var%20SHIFTS%20%3D%20%7B%20p%3A%200%2C%20n%3A%201%2C%20b%3A%202%2C%20r%3A%203%2C%20q%3A%204%2C%20k%3A%205%20%7D%0A%0A%20%20%20%20var%20FLAGS%20%3D%20%7B%0A%20%20%20%20%20%20NORMAL%3A%20'n'%2C%0A%20%20%20%20%20%20CAPTURE%3A%20'c'%2C%0A%20%20%20%20%20%20BIG_PAWN%3A%20'b'%2C%0A%20%20%20%20%20%20EP_CAPTURE%3A%20'e'%2C%0A%20%20%20%20%20%20PROMOTION%3A%20'p'%2C%0A%20%20%20%20%20%20KSIDE_CASTLE%3A%20'k'%2C%0A%20%20%20%20%20%20QSIDE_CASTLE%3A%20'q'%2C%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20BITS%20%3D%20%7B%0A%20%20%20%20%20%20NORMAL%3A%201%2C%0A%20%20%20%20%20%20CAPTURE%3A%202%2C%0A%20%20%20%20%20%20BIG_PAWN%3A%204%2C%0A%20%20%20%20%20%20EP_CAPTURE%3A%208%2C%0A%20%20%20%20%20%20PROMOTION%3A%2016%2C%0A%20%20%20%20%20%20KSIDE_CASTLE%3A%2032%2C%0A%20%20%20%20%20%20QSIDE_CASTLE%3A%2064%2C%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20RANK_1%20%3D%207%0A%20%20%20%20var%20RANK_2%20%3D%206%0A%20%20%20%20var%20RANK_3%20%3D%205%0A%20%20%20%20var%20RANK_4%20%3D%204%0A%20%20%20%20var%20RANK_5%20%3D%203%0A%20%20%20%20var%20RANK_6%20%3D%202%0A%20%20%20%20var%20RANK_7%20%3D%201%0A%20%20%20%20var%20RANK_8%20%3D%200%0A%0A%20%20%20%20%2F%2F%20prettier-ignore%0A%20%20%20%20var%20SQUARES%20%3D%20%7B%0A%20%20%20%20%20%20a8%3A%20%20%200%2C%20b8%3A%20%20%201%2C%20c8%3A%20%20%202%2C%20d8%3A%20%20%203%2C%20e8%3A%20%20%204%2C%20f8%3A%20%20%205%2C%20g8%3A%20%20%206%2C%20h8%3A%20%20%207%2C%0A%20%20%20%20%20%20a7%3A%20%2016%2C%20b7%3A%20%2017%2C%20c7%3A%20%2018%2C%20d7%3A%20%2019%2C%20e7%3A%20%2020%2C%20f7%3A%20%2021%2C%20g7%3A%20%2022%2C%20h7%3A%20%2023%2C%0A%20%20%20%20%20%20a6%3A%20%2032%2C%20b6%3A%20%2033%2C%20c6%3A%20%2034%2C%20d6%3A%20%2035%2C%20e6%3A%20%2036%2C%20f6%3A%20%2037%2C%20g6%3A%20%2038%2C%20h6%3A%20%2039%2C%0A%20%20%20%20%20%20a5%3A%20%2048%2C%20b5%3A%20%2049%2C%20c5%3A%20%2050%2C%20d5%3A%20%2051%2C%20e5%3A%20%2052%2C%20f5%3A%20%2053%2C%20g5%3A%20%2054%2C%20h5%3A%20%2055%2C%0A%20%20%20%20%20%20a4%3A%20%2064%2C%20b4%3A%20%2065%2C%20c4%3A%20%2066%2C%20d4%3A%20%2067%2C%20e4%3A%20%2068%2C%20f4%3A%20%2069%2C%20g4%3A%20%2070%2C%20h4%3A%20%2071%2C%0A%20%20%20%20%20%20a3%3A%20%2080%2C%20b3%3A%20%2081%2C%20c3%3A%20%2082%2C%20d3%3A%20%2083%2C%20e3%3A%20%2084%2C%20f3%3A%20%2085%2C%20g3%3A%20%2086%2C%20h3%3A%20%2087%2C%0A%20%20%20%20%20%20a2%3A%20%2096%2C%20b2%3A%20%2097%2C%20c2%3A%20%2098%2C%20d2%3A%20%2099%2C%20e2%3A%20100%2C%20f2%3A%20101%2C%20g2%3A%20102%2C%20h2%3A%20103%2C%0A%20%20%20%20%20%20a1%3A%20112%2C%20b1%3A%20113%2C%20c1%3A%20114%2C%20d1%3A%20115%2C%20e1%3A%20116%2C%20f1%3A%20117%2C%20g1%3A%20118%2C%20h1%3A%20119%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20var%20ROOKS%20%3D%20%7B%0A%20%20%20%20%20%20w%3A%20%5B%0A%20%20%20%20%20%20%20%20%7B%20square%3A%20SQUARES.a1%2C%20flag%3A%20BITS.QSIDE_CASTLE%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20square%3A%20SQUARES.h1%2C%20flag%3A%20BITS.KSIDE_CASTLE%20%7D%2C%0A%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%20%20b%3A%20%5B%0A%20%20%20%20%20%20%20%20%7B%20square%3A%20SQUARES.a8%2C%20flag%3A%20BITS.QSIDE_CASTLE%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20square%3A%20SQUARES.h8%2C%20flag%3A%20BITS.KSIDE_CASTLE%20%7D%2C%0A%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20board%20%3D%20new%20Array(128)%0A%20%20%20%20var%20kings%20%3D%20%7B%20w%3A%20EMPTY%2C%20b%3A%20EMPTY%20%7D%0A%20%20%20%20var%20turn%20%3D%20WHITE%0A%20%20%20%20var%20castling%20%3D%20%7B%20w%3A%200%2C%20b%3A%200%20%7D%0A%20%20%20%20var%20ep_square%20%3D%20EMPTY%0A%20%20%20%20var%20half_moves%20%3D%200%0A%20%20%20%20var%20move_number%20%3D%201%0A%20%20%20%20var%20history%20%3D%20%5B%5D%0A%20%20%20%20var%20header%20%3D%20%7B%7D%0A%20%20%20%20var%20comments%20%3D%20%7B%7D%0A%0A%20%20%20%20%2F*%20if%20the%20user%20passes%20in%20a%20fen%20string%2C%20load%20it%2C%20else%20default%20to%0A%20%20%20%20%20*%20starting%20position%0A%20%20%20%20%20*%2F%0A%20%20%20%20if%20(typeof%20fen%20%3D%3D%3D%20'undefined')%20%7B%0A%20%20%20%20%20%20load(DEFAULT_POSITION)%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20load(fen)%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20clear(keep_headers)%20%7B%0A%20%20%20%20%20%20if%20(typeof%20keep_headers%20%3D%3D%3D%20'undefined')%20%7B%0A%20%20%20%20%20%20%20%20keep_headers%20%3D%20false%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20board%20%3D%20new%20Array(128)%0A%20%20%20%20%20%20kings%20%3D%20%7B%20w%3A%20EMPTY%2C%20b%3A%20EMPTY%20%7D%0A%20%20%20%20%20%20turn%20%3D%20WHITE%0A%20%20%20%20%20%20castling%20%3D%20%7B%20w%3A%200%2C%20b%3A%200%20%7D%0A%20%20%20%20%20%20ep_square%20%3D%20EMPTY%0A%20%20%20%20%20%20half_moves%20%3D%200%0A%20%20%20%20%20%20move_number%20%3D%201%0A%20%20%20%20%20%20history%20%3D%20%5B%5D%0A%20%20%20%20%20%20if%20(!keep_headers)%20header%20%3D%20%7B%7D%0A%20%20%20%20%20%20comments%20%3D%20%7B%7D%0A%20%20%20%20%20%20update_setup(generate_fen())%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20prune_comments()%20%7B%0A%20%20%20%20%20%20var%20reversed_history%20%3D%20%5B%5D%0A%20%20%20%20%20%20var%20current_comments%20%3D%20%7B%7D%0A%20%20%20%20%20%20var%20copy_comment%20%3D%20function%20(fen)%20%7B%0A%20%20%20%20%20%20%20%20if%20(fen%20in%20comments)%20%7B%0A%20%20%20%20%20%20%20%20%20%20current_comments%5Bfen%5D%20%3D%20comments%5Bfen%5D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20while%20(history.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20reversed_history.push(undo_move())%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20copy_comment(generate_fen())%0A%20%20%20%20%20%20while%20(reversed_history.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20make_move(reversed_history.pop())%0A%20%20%20%20%20%20%20%20copy_comment(generate_fen())%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20comments%20%3D%20current_comments%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20reset()%20%7B%0A%20%20%20%20%20%20load(DEFAULT_POSITION)%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20load(fen%2C%20keep_headers)%20%7B%0A%20%20%20%20%20%20if%20(typeof%20keep_headers%20%3D%3D%3D%20'undefined')%20%7B%0A%20%20%20%20%20%20%20%20keep_headers%20%3D%20false%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20tokens%20%3D%20fen.split(%2F%5Cs%2B%2F)%0A%20%20%20%20%20%20var%20position%20%3D%20tokens%5B0%5D%0A%20%20%20%20%20%20var%20square%20%3D%200%0A%0A%20%20%20%20%20%20if%20(!validate_fen(fen).valid)%20%7B%0A%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20clear(keep_headers)%0A%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20position.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20var%20piece%20%3D%20position.charAt(i)%0A%0A%20%20%20%20%20%20%20%20if%20(piece%20%3D%3D%3D%20'%2F')%20%7B%0A%20%20%20%20%20%20%20%20%20%20square%20%2B%3D%208%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(is_digit(piece))%20%7B%0A%20%20%20%20%20%20%20%20%20%20square%20%2B%3D%20parseInt(piece%2C%2010)%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20color%20%3D%20piece%20%3C%20'a'%20%3F%20WHITE%20%3A%20BLACK%0A%20%20%20%20%20%20%20%20%20%20put(%7B%20type%3A%20piece.toLowerCase()%2C%20color%3A%20color%20%7D%2C%20algebraic(square))%0A%20%20%20%20%20%20%20%20%20%20square%2B%2B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20turn%20%3D%20tokens%5B1%5D%0A%0A%20%20%20%20%20%20if%20(tokens%5B2%5D.indexOf('K')%20%3E%20-1)%20%7B%0A%20%20%20%20%20%20%20%20castling.w%20%7C%3D%20BITS.KSIDE_CASTLE%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20(tokens%5B2%5D.indexOf('Q')%20%3E%20-1)%20%7B%0A%20%20%20%20%20%20%20%20castling.w%20%7C%3D%20BITS.QSIDE_CASTLE%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20(tokens%5B2%5D.indexOf('k')%20%3E%20-1)%20%7B%0A%20%20%20%20%20%20%20%20castling.b%20%7C%3D%20BITS.KSIDE_CASTLE%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20(tokens%5B2%5D.indexOf('q')%20%3E%20-1)%20%7B%0A%20%20%20%20%20%20%20%20castling.b%20%7C%3D%20BITS.QSIDE_CASTLE%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20ep_square%20%3D%20tokens%5B3%5D%20%3D%3D%3D%20'-'%20%3F%20EMPTY%20%3A%20SQUARES%5Btokens%5B3%5D%5D%0A%20%20%20%20%20%20half_moves%20%3D%20parseInt(tokens%5B4%5D%2C%2010)%0A%20%20%20%20%20%20move_number%20%3D%20parseInt(tokens%5B5%5D%2C%2010)%0A%0A%20%20%20%20%20%20update_setup(generate_fen())%0A%0A%20%20%20%20%20%20return%20true%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F*%20TODO%3A%20this%20function%20is%20pretty%20much%20crap%20-%20it%20validates%20structure%20but%0A%20%20%20%20%20*%20completely%20ignores%20content%20(e.g.%20doesn't%20verify%20that%20each%20side%20has%20a%20king)%0A%20%20%20%20%20*%20...%20we%20should%20rewrite%20this%2C%20and%20ditch%20the%20silly%20error_number%20field%20while%0A%20%20%20%20%20*%20we're%20at%20it%0A%20%20%20%20%20*%2F%0A%20%20%20%20function%20validate_fen(fen)%20%7B%0A%20%20%20%20%20%20var%20errors%20%3D%20%7B%0A%20%20%20%20%20%20%20%200%3A%20'No%20errors.'%2C%0A%20%20%20%20%20%20%20%201%3A%20'FEN%20string%20must%20contain%20six%20space-delimited%20fields.'%2C%0A%20%20%20%20%20%20%20%202%3A%20'6th%20field%20(move%20number)%20must%20be%20a%20positive%20integer.'%2C%0A%20%20%20%20%20%20%20%203%3A%20'5th%20field%20(half%20move%20counter)%20must%20be%20a%20non-negative%20integer.'%2C%0A%20%20%20%20%20%20%20%204%3A%20'4th%20field%20(en-passant%20square)%20is%20invalid.'%2C%0A%20%20%20%20%20%20%20%205%3A%20'3rd%20field%20(castling%20availability)%20is%20invalid.'%2C%0A%20%20%20%20%20%20%20%206%3A%20'2nd%20field%20(side%20to%20move)%20is%20invalid.'%2C%0A%20%20%20%20%20%20%20%207%3A%20%221st%20field%20(piece%20positions)%20does%20not%20contain%208%20'%2F'-delimited%20rows.%22%2C%0A%20%20%20%20%20%20%20%208%3A%20'1st%20field%20(piece%20positions)%20is%20invalid%20%5Bconsecutive%20numbers%5D.'%2C%0A%20%20%20%20%20%20%20%209%3A%20'1st%20field%20(piece%20positions)%20is%20invalid%20%5Binvalid%20piece%5D.'%2C%0A%20%20%20%20%20%20%20%2010%3A%20'1st%20field%20(piece%20positions)%20is%20invalid%20%5Brow%20too%20large%5D.'%2C%0A%20%20%20%20%20%20%20%2011%3A%20'Illegal%20en-passant%20square'%2C%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%201st%20criterion%3A%206%20space-seperated%20fields%3F%20*%2F%0A%20%20%20%20%20%20var%20tokens%20%3D%20fen.split(%2F%5Cs%2B%2F)%0A%20%20%20%20%20%20if%20(tokens.length%20!%3D%3D%206)%20%7B%0A%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%201%2C%20error%3A%20errors%5B1%5D%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%202nd%20criterion%3A%20move%20number%20field%20is%20a%20integer%20value%20%3E%200%3F%20*%2F%0A%20%20%20%20%20%20if%20(isNaN(tokens%5B5%5D)%20%7C%7C%20parseInt(tokens%5B5%5D%2C%2010)%20%3C%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%202%2C%20error%3A%20errors%5B2%5D%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%203rd%20criterion%3A%20half%20move%20counter%20is%20an%20integer%20%3E%3D%200%3F%20*%2F%0A%20%20%20%20%20%20if%20(isNaN(tokens%5B4%5D)%20%7C%7C%20parseInt(tokens%5B4%5D%2C%2010)%20%3C%200)%20%7B%0A%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%203%2C%20error%3A%20errors%5B3%5D%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%204th%20criterion%3A%204th%20field%20is%20a%20valid%20e.p.-string%3F%20*%2F%0A%20%20%20%20%20%20if%20(!%2F%5E(-%7C%5Babcdefgh%5D%5B36%5D)%24%2F.test(tokens%5B3%5D))%20%7B%0A%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%204%2C%20error%3A%20errors%5B4%5D%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%205th%20criterion%3A%203th%20field%20is%20a%20valid%20castle-string%3F%20*%2F%0A%20%20%20%20%20%20if%20(!%2F%5E(KQ%3Fk%3Fq%3F%7CQk%3Fq%3F%7Ckq%3F%7Cq%7C-)%24%2F.test(tokens%5B2%5D))%20%7B%0A%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%205%2C%20error%3A%20errors%5B5%5D%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%206th%20criterion%3A%202nd%20field%20is%20%22w%22%20(white)%20or%20%22b%22%20(black)%3F%20*%2F%0A%20%20%20%20%20%20if%20(!%2F%5E(w%7Cb)%24%2F.test(tokens%5B1%5D))%20%7B%0A%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%206%2C%20error%3A%20errors%5B6%5D%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%207th%20criterion%3A%201st%20field%20contains%208%20rows%3F%20*%2F%0A%20%20%20%20%20%20var%20rows%20%3D%20tokens%5B0%5D.split('%2F')%0A%20%20%20%20%20%20if%20(rows.length%20!%3D%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%207%2C%20error%3A%20errors%5B7%5D%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%208th%20criterion%3A%20every%20row%20is%20valid%3F%20*%2F%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20rows.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20check%20for%20right%20sum%20of%20fields%20AND%20not%20two%20numbers%20in%20succession%20*%2F%0A%20%20%20%20%20%20%20%20var%20sum_fields%20%3D%200%0A%20%20%20%20%20%20%20%20var%20previous_was_number%20%3D%20false%0A%0A%20%20%20%20%20%20%20%20for%20(var%20k%20%3D%200%3B%20k%20%3C%20rows%5Bi%5D.length%3B%20k%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(!isNaN(rows%5Bi%5D%5Bk%5D))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(previous_was_number)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%208%2C%20error%3A%20errors%5B8%5D%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20sum_fields%20%2B%3D%20parseInt(rows%5Bi%5D%5Bk%5D%2C%2010)%0A%20%20%20%20%20%20%20%20%20%20%20%20previous_was_number%20%3D%20true%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!%2F%5E%5BprnbqkPRNBQK%5D%24%2F.test(rows%5Bi%5D%5Bk%5D))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%209%2C%20error%3A%20errors%5B9%5D%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20sum_fields%20%2B%3D%201%0A%20%20%20%20%20%20%20%20%20%20%20%20previous_was_number%20%3D%20false%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20(sum_fields%20!%3D%3D%208)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%2010%2C%20error%3A%20errors%5B10%5D%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20(tokens%5B3%5D%5B1%5D%20%3D%3D%20'3'%20%26%26%20tokens%5B1%5D%20%3D%3D%20'w')%20%7C%7C%0A%20%20%20%20%20%20%20%20(tokens%5B3%5D%5B1%5D%20%3D%3D%20'6'%20%26%26%20tokens%5B1%5D%20%3D%3D%20'b')%0A%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20return%20%7B%20valid%3A%20false%2C%20error_number%3A%2011%2C%20error%3A%20errors%5B11%5D%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20everything's%20okay!%20*%2F%0A%20%20%20%20%20%20return%20%7B%20valid%3A%20true%2C%20error_number%3A%200%2C%20error%3A%20errors%5B0%5D%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20generate_fen()%20%7B%0A%20%20%20%20%20%20var%20empty%20%3D%200%0A%20%20%20%20%20%20var%20fen%20%3D%20''%0A%0A%20%20%20%20%20%20for%20(var%20i%20%3D%20SQUARES.a8%3B%20i%20%3C%3D%20SQUARES.h1%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20if%20(board%5Bi%5D%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20empty%2B%2B%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(empty%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fen%20%2B%3D%20empty%0A%20%20%20%20%20%20%20%20%20%20%20%20empty%20%3D%200%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20var%20color%20%3D%20board%5Bi%5D.color%0A%20%20%20%20%20%20%20%20%20%20var%20piece%20%3D%20board%5Bi%5D.type%0A%0A%20%20%20%20%20%20%20%20%20%20fen%20%2B%3D%20color%20%3D%3D%3D%20WHITE%20%3F%20piece.toUpperCase()%20%3A%20piece.toLowerCase()%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20((i%20%2B%201)%20%26%200x88)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(empty%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fen%20%2B%3D%20empty%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20if%20(i%20!%3D%3D%20SQUARES.h1)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20fen%20%2B%3D%20'%2F'%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20empty%20%3D%200%0A%20%20%20%20%20%20%20%20%20%20i%20%2B%3D%208%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20cflags%20%3D%20''%0A%20%20%20%20%20%20if%20(castling%5BWHITE%5D%20%26%20BITS.KSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20cflags%20%2B%3D%20'K'%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20(castling%5BWHITE%5D%20%26%20BITS.QSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20cflags%20%2B%3D%20'Q'%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20(castling%5BBLACK%5D%20%26%20BITS.KSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20cflags%20%2B%3D%20'k'%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20if%20(castling%5BBLACK%5D%20%26%20BITS.QSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20cflags%20%2B%3D%20'q'%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20do%20we%20have%20an%20empty%20castling%20flag%3F%20*%2F%0A%20%20%20%20%20%20cflags%20%3D%20cflags%20%7C%7C%20'-'%0A%20%20%20%20%20%20var%20epflags%20%3D%20ep_square%20%3D%3D%3D%20EMPTY%20%3F%20'-'%20%3A%20algebraic(ep_square)%0A%0A%20%20%20%20%20%20return%20%5Bfen%2C%20turn%2C%20cflags%2C%20epflags%2C%20half_moves%2C%20move_number%5D.join('%20')%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20set_header(args)%20%7B%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20args.length%3B%20i%20%2B%3D%202)%20%7B%0A%20%20%20%20%20%20%20%20if%20(typeof%20args%5Bi%5D%20%3D%3D%3D%20'string'%20%26%26%20typeof%20args%5Bi%20%2B%201%5D%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20%20%20%20%20%20%20header%5Bargs%5Bi%5D%5D%20%3D%20args%5Bi%20%2B%201%5D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20header%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F*%20called%20when%20the%20initial%20board%20setup%20is%20changed%20with%20put()%20or%20remove().%0A%20%20%20%20%20*%20modifies%20the%20SetUp%20and%20FEN%20properties%20of%20the%20header%20object.%20%20if%20the%20FEN%20is%0A%20%20%20%20%20*%20equal%20to%20the%20default%20position%2C%20the%20SetUp%20and%20FEN%20are%20deleted%0A%20%20%20%20%20*%20the%20setup%20is%20only%20updated%20if%20history.length%20is%20zero%2C%20ie%20moves%20haven't%20been%0A%20%20%20%20%20*%20made.%0A%20%20%20%20%20*%2F%0A%20%20%20%20function%20update_setup(fen)%20%7B%0A%20%20%20%20%20%20if%20(history.length%20%3E%200)%20return%0A%0A%20%20%20%20%20%20if%20(fen%20!%3D%3D%20DEFAULT_POSITION)%20%7B%0A%20%20%20%20%20%20%20%20header%5B'SetUp'%5D%20%3D%20'1'%0A%20%20%20%20%20%20%20%20header%5B'FEN'%5D%20%3D%20fen%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20delete%20header%5B'SetUp'%5D%0A%20%20%20%20%20%20%20%20delete%20header%5B'FEN'%5D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20get(square)%20%7B%0A%20%20%20%20%20%20var%20piece%20%3D%20board%5BSQUARES%5Bsquare%5D%5D%0A%20%20%20%20%20%20return%20piece%20%3F%20%7B%20type%3A%20piece.type%2C%20color%3A%20piece.color%20%7D%20%3A%20null%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20put(piece%2C%20square)%20%7B%0A%20%20%20%20%20%20%2F*%20check%20for%20valid%20piece%20object%20*%2F%0A%20%20%20%20%20%20if%20(!('type'%20in%20piece%20%26%26%20'color'%20in%20piece))%20%7B%0A%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20check%20for%20piece%20*%2F%0A%20%20%20%20%20%20if%20(SYMBOLS.indexOf(piece.type.toLowerCase())%20%3D%3D%3D%20-1)%20%7B%0A%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20check%20for%20valid%20square%20*%2F%0A%20%20%20%20%20%20if%20(!(square%20in%20SQUARES))%20%7B%0A%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20sq%20%3D%20SQUARES%5Bsquare%5D%0A%0A%20%20%20%20%20%20%2F*%20don't%20let%20the%20user%20place%20more%20than%20one%20king%20*%2F%0A%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20piece.type%20%3D%3D%20KING%20%26%26%0A%20%20%20%20%20%20%20%20!(kings%5Bpiece.color%5D%20%3D%3D%20EMPTY%20%7C%7C%20kings%5Bpiece.color%5D%20%3D%3D%20sq)%0A%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20board%5Bsq%5D%20%3D%20%7B%20type%3A%20piece.type%2C%20color%3A%20piece.color%20%7D%0A%20%20%20%20%20%20if%20(piece.type%20%3D%3D%3D%20KING)%20%7B%0A%20%20%20%20%20%20%20%20kings%5Bpiece.color%5D%20%3D%20sq%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20update_setup(generate_fen())%0A%0A%20%20%20%20%20%20return%20true%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20remove(square)%20%7B%0A%20%20%20%20%20%20var%20piece%20%3D%20get(square)%0A%20%20%20%20%20%20board%5BSQUARES%5Bsquare%5D%5D%20%3D%20null%0A%20%20%20%20%20%20if%20(piece%20%26%26%20piece.type%20%3D%3D%3D%20KING)%20%7B%0A%20%20%20%20%20%20%20%20kings%5Bpiece.color%5D%20%3D%20EMPTY%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20update_setup(generate_fen())%0A%0A%20%20%20%20%20%20return%20piece%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20build_move(board%2C%20from%2C%20to%2C%20flags%2C%20promotion)%20%7B%0A%20%20%20%20%20%20var%20move%20%3D%20%7B%0A%20%20%20%20%20%20%20%20color%3A%20turn%2C%0A%20%20%20%20%20%20%20%20from%3A%20from%2C%0A%20%20%20%20%20%20%20%20to%3A%20to%2C%0A%20%20%20%20%20%20%20%20flags%3A%20flags%2C%0A%20%20%20%20%20%20%20%20piece%3A%20board%5Bfrom%5D.type%2C%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20(promotion)%20%7B%0A%20%20%20%20%20%20%20%20move.flags%20%7C%3D%20BITS.PROMOTION%0A%20%20%20%20%20%20%20%20move.promotion%20%3D%20promotion%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20(board%5Bto%5D)%20%7B%0A%20%20%20%20%20%20%20%20move.captured%20%3D%20board%5Bto%5D.type%0A%20%20%20%20%20%20%7D%20else%20if%20(flags%20%26%20BITS.EP_CAPTURE)%20%7B%0A%20%20%20%20%20%20%20%20move.captured%20%3D%20PAWN%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20move%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20generate_moves(options)%20%7B%0A%20%20%20%20%20%20function%20add_move(board%2C%20moves%2C%20from%2C%20to%2C%20flags)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20if%20pawn%20promotion%20*%2F%0A%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20board%5Bfrom%5D.type%20%3D%3D%3D%20PAWN%20%26%26%0A%20%20%20%20%20%20%20%20%20%20(rank(to)%20%3D%3D%3D%20RANK_8%20%7C%7C%20rank(to)%20%3D%3D%3D%20RANK_1)%0A%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20pieces%20%3D%20%5BQUEEN%2C%20ROOK%2C%20BISHOP%2C%20KNIGHT%5D%0A%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20pieces.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20moves.push(build_move(board%2C%20from%2C%20to%2C%20flags%2C%20pieces%5Bi%5D))%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20moves.push(build_move(board%2C%20from%2C%20to%2C%20flags))%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20moves%20%3D%20%5B%5D%0A%20%20%20%20%20%20var%20us%20%3D%20turn%0A%20%20%20%20%20%20var%20them%20%3D%20swap_color(us)%0A%20%20%20%20%20%20var%20second_rank%20%3D%20%7B%20b%3A%20RANK_7%2C%20w%3A%20RANK_2%20%7D%0A%0A%20%20%20%20%20%20var%20first_sq%20%3D%20SQUARES.a8%0A%20%20%20%20%20%20var%20last_sq%20%3D%20SQUARES.h1%0A%20%20%20%20%20%20var%20single_square%20%3D%20false%0A%0A%20%20%20%20%20%20%2F*%20do%20we%20want%20legal%20moves%3F%20*%2F%0A%20%20%20%20%20%20var%20legal%20%3D%0A%20%20%20%20%20%20%20%20typeof%20options%20!%3D%3D%20'undefined'%20%26%26%20'legal'%20in%20options%0A%20%20%20%20%20%20%20%20%20%20%3F%20options.legal%0A%20%20%20%20%20%20%20%20%20%20%3A%20true%0A%0A%20%20%20%20%20%20var%20piece_type%20%3D%0A%20%20%20%20%20%20%20%20typeof%20options%20!%3D%3D%20'undefined'%20%26%26%0A%20%20%20%20%20%20%20%20'piece'%20in%20options%20%26%26%0A%20%20%20%20%20%20%20%20typeof%20options.piece%20%3D%3D%3D%20'string'%0A%20%20%20%20%20%20%20%20%20%20%3F%20options.piece.toLowerCase()%0A%20%20%20%20%20%20%20%20%20%20%3A%20true%0A%0A%20%20%20%20%20%20%2F*%20are%20we%20generating%20moves%20for%20a%20single%20square%3F%20*%2F%0A%20%20%20%20%20%20if%20(typeof%20options%20!%3D%3D%20'undefined'%20%26%26%20'square'%20in%20options)%20%7B%0A%20%20%20%20%20%20%20%20if%20(options.square%20in%20SQUARES)%20%7B%0A%20%20%20%20%20%20%20%20%20%20first_sq%20%3D%20last_sq%20%3D%20SQUARES%5Boptions.square%5D%0A%20%20%20%20%20%20%20%20%20%20single_square%20%3D%20true%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F*%20invalid%20square%20*%2F%0A%20%20%20%20%20%20%20%20%20%20return%20%5B%5D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20for%20(var%20i%20%3D%20first_sq%3B%20i%20%3C%3D%20last_sq%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20did%20we%20run%20off%20the%20end%20of%20the%20board%20*%2F%0A%20%20%20%20%20%20%20%20if%20(i%20%26%200x88)%20%7B%0A%20%20%20%20%20%20%20%20%20%20i%20%2B%3D%207%0A%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20piece%20%3D%20board%5Bi%5D%0A%20%20%20%20%20%20%20%20if%20(piece%20%3D%3D%20null%20%7C%7C%20piece.color%20!%3D%3D%20us)%20%7B%0A%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20(piece.type%20%3D%3D%3D%20PAWN%20%26%26%20(piece_type%20%3D%3D%3D%20true%20%7C%7C%20piece_type%20%3D%3D%3D%20PAWN))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F*%20single%20square%2C%20non-capturing%20*%2F%0A%20%20%20%20%20%20%20%20%20%20var%20square%20%3D%20i%20%2B%20PAWN_OFFSETS%5Bus%5D%5B0%5D%0A%20%20%20%20%20%20%20%20%20%20if%20(board%5Bsquare%5D%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20add_move(board%2C%20moves%2C%20i%2C%20square%2C%20BITS.NORMAL)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F*%20double%20square%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20square%20%3D%20i%20%2B%20PAWN_OFFSETS%5Bus%5D%5B1%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(second_rank%5Bus%5D%20%3D%3D%3D%20rank(i)%20%26%26%20board%5Bsquare%5D%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20add_move(board%2C%20moves%2C%20i%2C%20square%2C%20BITS.BIG_PAWN)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%2F*%20pawn%20captures%20*%2F%0A%20%20%20%20%20%20%20%20%20%20for%20(j%20%3D%202%3B%20j%20%3C%204%3B%20j%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20square%20%3D%20i%20%2B%20PAWN_OFFSETS%5Bus%5D%5Bj%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(square%20%26%200x88)%20continue%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(board%5Bsquare%5D%20!%3D%20null%20%26%26%20board%5Bsquare%5D.color%20%3D%3D%3D%20them)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20add_move(board%2C%20moves%2C%20i%2C%20square%2C%20BITS.CAPTURE)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(square%20%3D%3D%3D%20ep_square)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20add_move(board%2C%20moves%2C%20i%2C%20ep_square%2C%20BITS.EP_CAPTURE)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(piece_type%20%3D%3D%3D%20true%20%7C%7C%20piece_type%20%3D%3D%3D%20piece.type)%20%7B%0A%20%20%20%20%20%20%20%20%20%20for%20(var%20j%20%3D%200%2C%20len%20%3D%20PIECE_OFFSETS%5Bpiece.type%5D.length%3B%20j%20%3C%20len%3B%20j%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20offset%20%3D%20PIECE_OFFSETS%5Bpiece.type%5D%5Bj%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20square%20%3D%20i%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20while%20(true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20square%20%2B%3D%20offset%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(square%20%26%200x88)%20break%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(board%5Bsquare%5D%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20add_move(board%2C%20moves%2C%20i%2C%20square%2C%20BITS.NORMAL)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(board%5Bsquare%5D.color%20%3D%3D%3D%20us)%20break%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20add_move(board%2C%20moves%2C%20i%2C%20square%2C%20BITS.CAPTURE)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F*%20break%2C%20if%20knight%20or%20king%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(piece.type%20%3D%3D%3D%20'n'%20%7C%7C%20piece.type%20%3D%3D%3D%20'k')%20break%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20check%20for%20castling%20if%3A%20a)%20we're%20generating%20all%20moves%2C%20or%20b)%20we're%20doing%0A%20%20%20%20%20%20%20*%20single%20square%20move%20generation%20on%20the%20king's%20square%0A%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20if%20(piece_type%20%3D%3D%3D%20true%20%7C%7C%20piece_type%20%3D%3D%3D%20KING)%20%7B%0A%20%20%20%20%20%20%20%20if%20(!single_square%20%7C%7C%20last_sq%20%3D%3D%3D%20kings%5Bus%5D)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F*%20king-side%20castling%20*%2F%0A%20%20%20%20%20%20%20%20%20%20if%20(castling%5Bus%5D%20%26%20BITS.KSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20castling_from%20%3D%20kings%5Bus%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20castling_to%20%3D%20castling_from%20%2B%202%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bcastling_from%20%2B%201%5D%20%3D%3D%20null%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bcastling_to%5D%20%3D%3D%20null%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20!attacked(them%2C%20kings%5Bus%5D)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20!attacked(them%2C%20castling_from%20%2B%201)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20!attacked(them%2C%20castling_to)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20add_move(board%2C%20moves%2C%20kings%5Bus%5D%2C%20castling_to%2C%20BITS.KSIDE_CASTLE)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%2F*%20queen-side%20castling%20*%2F%0A%20%20%20%20%20%20%20%20%20%20if%20(castling%5Bus%5D%20%26%20BITS.QSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20castling_from%20%3D%20kings%5Bus%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20castling_to%20%3D%20castling_from%20-%202%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bcastling_from%20-%201%5D%20%3D%3D%20null%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bcastling_from%20-%202%5D%20%3D%3D%20null%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20board%5Bcastling_from%20-%203%5D%20%3D%3D%20null%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20!attacked(them%2C%20kings%5Bus%5D)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20!attacked(them%2C%20castling_from%20-%201)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20!attacked(them%2C%20castling_to)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20add_move(board%2C%20moves%2C%20kings%5Bus%5D%2C%20castling_to%2C%20BITS.QSIDE_CASTLE)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20return%20all%20pseudo-legal%20moves%20(this%20includes%20moves%20that%20allow%20the%20king%0A%20%20%20%20%20%20%20*%20to%20be%20captured)%0A%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20if%20(!legal)%20%7B%0A%20%20%20%20%20%20%20%20return%20moves%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20filter%20out%20illegal%20moves%20*%2F%0A%20%20%20%20%20%20var%20legal_moves%20%3D%20%5B%5D%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20moves.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20make_move(moves%5Bi%5D)%0A%20%20%20%20%20%20%20%20if%20(!king_attacked(us))%20%7B%0A%20%20%20%20%20%20%20%20%20%20legal_moves.push(moves%5Bi%5D)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20undo_move()%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20legal_moves%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F*%20convert%20a%20move%20from%200x88%20coordinates%20to%20Standard%20Algebraic%20Notation%0A%20%20%20%20%20*%20(SAN)%0A%20%20%20%20%20*%0A%20%20%20%20%20*%20%40param%20%7Bboolean%7D%20sloppy%20Use%20the%20sloppy%20SAN%20generator%20to%20work%20around%20over%0A%20%20%20%20%20*%20disambiguation%20bugs%20in%20Fritz%20and%20Chessbase.%20%20See%20below%3A%0A%20%20%20%20%20*%0A%20%20%20%20%20*%20r1bqkbnr%2Fppp2ppp%2F2n5%2F1B1pP3%2F4P3%2F8%2FPPPP2PP%2FRNBQK1NR%20b%20KQkq%20-%202%204%0A%20%20%20%20%20*%204.%20...%20Nge7%20is%20overly%20disambiguated%20because%20the%20knight%20on%20c6%20is%20pinned%0A%20%20%20%20%20*%204.%20...%20Ne7%20is%20technically%20the%20valid%20SAN%0A%20%20%20%20%20*%2F%0A%20%20%20%20function%20move_to_san(move%2C%20moves)%20%7B%0A%20%20%20%20%20%20var%20output%20%3D%20''%0A%0A%20%20%20%20%20%20if%20(move.flags%20%26%20BITS.KSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20output%20%3D%20'O-O'%0A%20%20%20%20%20%20%7D%20else%20if%20(move.flags%20%26%20BITS.QSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20output%20%3D%20'O-O-O'%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20if%20(move.piece%20!%3D%3D%20PAWN)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20disambiguator%20%3D%20get_disambiguator(move%2C%20moves)%0A%20%20%20%20%20%20%20%20%20%20output%20%2B%3D%20move.piece.toUpperCase()%20%2B%20disambiguator%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20(move.flags%20%26%20(BITS.CAPTURE%20%7C%20BITS.EP_CAPTURE))%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(move.piece%20%3D%3D%3D%20PAWN)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20output%20%2B%3D%20algebraic(move.from)%5B0%5D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20output%20%2B%3D%20'x'%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20output%20%2B%3D%20algebraic(move.to)%0A%0A%20%20%20%20%20%20%20%20if%20(move.flags%20%26%20BITS.PROMOTION)%20%7B%0A%20%20%20%20%20%20%20%20%20%20output%20%2B%3D%20'%3D'%20%2B%20move.promotion.toUpperCase()%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20make_move(move)%0A%20%20%20%20%20%20if%20(in_check())%20%7B%0A%20%20%20%20%20%20%20%20if%20(in_checkmate())%20%7B%0A%20%20%20%20%20%20%20%20%20%20output%20%2B%3D%20'%23'%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20output%20%2B%3D%20'%2B'%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20undo_move()%0A%0A%20%20%20%20%20%20return%20output%0A%20%20%20%20%7D%0A%20%20%20%20%2F%2F%20parses%20all%20of%20the%20decorators%20out%20of%20a%20SAN%20string%0A%20%20%20%20function%20stripped_san(move)%20%7B%0A%20%20%20%20%20%20return%20move.replace(%2F%3D%2F%2C%20'').replace(%2F%5B%2B%23%5D%3F%5B%3F!%5D*%24%2F%2C%20'')%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20attacked(color%2C%20square)%20%7B%0A%20%20%20%20%20%20for%20(var%20i%20%3D%20SQUARES.a8%3B%20i%20%3C%3D%20SQUARES.h1%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20did%20we%20run%20off%20the%20end%20of%20the%20board%20*%2F%0A%20%20%20%20%20%20%20%20if%20(i%20%26%200x88)%20%7B%0A%20%20%20%20%20%20%20%20%20%20i%20%2B%3D%207%0A%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20if%20empty%20square%20or%20wrong%20color%20*%2F%0A%20%20%20%20%20%20%20%20if%20(board%5Bi%5D%20%3D%3D%20null%20%7C%7C%20board%5Bi%5D.color%20!%3D%3D%20color)%20continue%0A%0A%20%20%20%20%20%20%20%20var%20piece%20%3D%20board%5Bi%5D%0A%20%20%20%20%20%20%20%20var%20difference%20%3D%20i%20-%20square%0A%20%20%20%20%20%20%20%20var%20index%20%3D%20difference%20%2B%20119%0A%0A%20%20%20%20%20%20%20%20if%20(ATTACKS%5Bindex%5D%20%26%20(1%20%3C%3C%20SHIFTS%5Bpiece.type%5D))%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(piece.type%20%3D%3D%3D%20PAWN)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(difference%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(piece.color%20%3D%3D%3D%20WHITE)%20return%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(piece.color%20%3D%3D%3D%20BLACK)%20return%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%2F*%20if%20the%20piece%20is%20a%20knight%20or%20a%20king%20*%2F%0A%20%20%20%20%20%20%20%20%20%20if%20(piece.type%20%3D%3D%3D%20'n'%20%7C%7C%20piece.type%20%3D%3D%3D%20'k')%20return%20true%0A%0A%20%20%20%20%20%20%20%20%20%20var%20offset%20%3D%20RAYS%5Bindex%5D%0A%20%20%20%20%20%20%20%20%20%20var%20j%20%3D%20i%20%2B%20offset%0A%0A%20%20%20%20%20%20%20%20%20%20var%20blocked%20%3D%20false%0A%20%20%20%20%20%20%20%20%20%20while%20(j%20!%3D%3D%20square)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(board%5Bj%5D%20!%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20blocked%20%3D%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20j%20%2B%3D%20offset%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20if%20(!blocked)%20return%20true%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20false%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20king_attacked(color)%20%7B%0A%20%20%20%20%20%20return%20attacked(swap_color(color)%2C%20kings%5Bcolor%5D)%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20in_check()%20%7B%0A%20%20%20%20%20%20return%20king_attacked(turn)%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20in_checkmate()%20%7B%0A%20%20%20%20%20%20return%20in_check()%20%26%26%20generate_moves().length%20%3D%3D%3D%200%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20in_stalemate()%20%7B%0A%20%20%20%20%20%20return%20!in_check()%20%26%26%20generate_moves().length%20%3D%3D%3D%200%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20insufficient_material()%20%7B%0A%20%20%20%20%20%20var%20pieces%20%3D%20%7B%7D%0A%20%20%20%20%20%20var%20bishops%20%3D%20%5B%5D%0A%20%20%20%20%20%20var%20num_pieces%20%3D%200%0A%20%20%20%20%20%20var%20sq_color%20%3D%200%0A%0A%20%20%20%20%20%20for%20(var%20i%20%3D%20SQUARES.a8%3B%20i%20%3C%3D%20SQUARES.h1%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20sq_color%20%3D%20(sq_color%20%2B%201)%20%25%202%0A%20%20%20%20%20%20%20%20if%20(i%20%26%200x88)%20%7B%0A%20%20%20%20%20%20%20%20%20%20i%20%2B%3D%207%0A%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20piece%20%3D%20board%5Bi%5D%0A%20%20%20%20%20%20%20%20if%20(piece)%20%7B%0A%20%20%20%20%20%20%20%20%20%20pieces%5Bpiece.type%5D%20%3D%20piece.type%20in%20pieces%20%3F%20pieces%5Bpiece.type%5D%20%2B%201%20%3A%201%0A%20%20%20%20%20%20%20%20%20%20if%20(piece.type%20%3D%3D%3D%20BISHOP)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20bishops.push(sq_color)%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20num_pieces%2B%2B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20k%20vs.%20k%20*%2F%0A%20%20%20%20%20%20if%20(num_pieces%20%3D%3D%3D%202)%20%7B%0A%20%20%20%20%20%20%20%20return%20true%0A%20%20%20%20%20%20%7D%20else%20if%20(%0A%20%20%20%20%20%20%20%20%2F*%20k%20vs.%20kn%20....%20or%20....%20k%20vs.%20kb%20*%2F%0A%20%20%20%20%20%20%20%20num_pieces%20%3D%3D%3D%203%20%26%26%0A%20%20%20%20%20%20%20%20(pieces%5BBISHOP%5D%20%3D%3D%3D%201%20%7C%7C%20pieces%5BKNIGHT%5D%20%3D%3D%3D%201)%0A%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20return%20true%0A%20%20%20%20%20%20%7D%20else%20if%20(num_pieces%20%3D%3D%3D%20pieces%5BBISHOP%5D%20%2B%202)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20kb%20vs.%20kb%20where%20any%20number%20of%20bishops%20are%20all%20on%20the%20same%20color%20*%2F%0A%20%20%20%20%20%20%20%20var%20sum%20%3D%200%0A%20%20%20%20%20%20%20%20var%20len%20%3D%20bishops.length%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20sum%20%2B%3D%20bishops%5Bi%5D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20(sum%20%3D%3D%3D%200%20%7C%7C%20sum%20%3D%3D%3D%20len)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20true%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20false%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20in_threefold_repetition()%20%7B%0A%20%20%20%20%20%20%2F*%20TODO%3A%20while%20this%20function%20is%20fine%20for%20casual%20use%2C%20a%20better%0A%20%20%20%20%20%20%20*%20implementation%20would%20use%20a%20Zobrist%20key%20(instead%20of%20FEN).%20the%0A%20%20%20%20%20%20%20*%20Zobrist%20key%20would%20be%20maintained%20in%20the%20make_move%2Fundo_move%20functions%2C%0A%20%20%20%20%20%20%20*%20avoiding%20the%20costly%20that%20we%20do%20below.%0A%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20var%20moves%20%3D%20%5B%5D%0A%20%20%20%20%20%20var%20positions%20%3D%20%7B%7D%0A%20%20%20%20%20%20var%20repetition%20%3D%20false%0A%0A%20%20%20%20%20%20while%20(true)%20%7B%0A%20%20%20%20%20%20%20%20var%20move%20%3D%20undo_move()%0A%20%20%20%20%20%20%20%20if%20(!move)%20break%0A%20%20%20%20%20%20%20%20moves.push(move)%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20while%20(true)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20remove%20the%20last%20two%20fields%20in%20the%20FEN%20string%2C%20they're%20not%20needed%0A%20%20%20%20%20%20%20%20%20*%20when%20checking%20for%20draw%20by%20rep%20*%2F%0A%20%20%20%20%20%20%20%20var%20fen%20%3D%20generate_fen().split('%20').slice(0%2C%204).join('%20')%0A%0A%20%20%20%20%20%20%20%20%2F*%20has%20the%20position%20occurred%20three%20or%20move%20times%20*%2F%0A%20%20%20%20%20%20%20%20positions%5Bfen%5D%20%3D%20fen%20in%20positions%20%3F%20positions%5Bfen%5D%20%2B%201%20%3A%201%0A%20%20%20%20%20%20%20%20if%20(positions%5Bfen%5D%20%3E%3D%203)%20%7B%0A%20%20%20%20%20%20%20%20%20%20repetition%20%3D%20true%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20(!moves.length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20make_move(moves.pop())%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20repetition%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20push(move)%20%7B%0A%20%20%20%20%20%20history.push(%7B%0A%20%20%20%20%20%20%20%20move%3A%20move%2C%0A%20%20%20%20%20%20%20%20kings%3A%20%7B%20b%3A%20kings.b%2C%20w%3A%20kings.w%20%7D%2C%0A%20%20%20%20%20%20%20%20turn%3A%20turn%2C%0A%20%20%20%20%20%20%20%20castling%3A%20%7B%20b%3A%20castling.b%2C%20w%3A%20castling.w%20%7D%2C%0A%20%20%20%20%20%20%20%20ep_square%3A%20ep_square%2C%0A%20%20%20%20%20%20%20%20half_moves%3A%20half_moves%2C%0A%20%20%20%20%20%20%20%20move_number%3A%20move_number%2C%0A%20%20%20%20%20%20%7D)%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20make_move(move)%20%7B%0A%20%20%20%20%20%20var%20us%20%3D%20turn%0A%20%20%20%20%20%20var%20them%20%3D%20swap_color(us)%0A%20%20%20%20%20%20push(move)%0A%0A%20%20%20%20%20%20board%5Bmove.to%5D%20%3D%20board%5Bmove.from%5D%0A%20%20%20%20%20%20board%5Bmove.from%5D%20%3D%20null%0A%0A%20%20%20%20%20%20%2F*%20if%20ep%20capture%2C%20remove%20the%20captured%20pawn%20*%2F%0A%20%20%20%20%20%20if%20(move.flags%20%26%20BITS.EP_CAPTURE)%20%7B%0A%20%20%20%20%20%20%20%20if%20(turn%20%3D%3D%3D%20BLACK)%20%7B%0A%20%20%20%20%20%20%20%20%20%20board%5Bmove.to%20-%2016%5D%20%3D%20null%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20board%5Bmove.to%20%2B%2016%5D%20%3D%20null%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20if%20pawn%20promotion%2C%20replace%20with%20new%20piece%20*%2F%0A%20%20%20%20%20%20if%20(move.flags%20%26%20BITS.PROMOTION)%20%7B%0A%20%20%20%20%20%20%20%20board%5Bmove.to%5D%20%3D%20%7B%20type%3A%20move.promotion%2C%20color%3A%20us%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20if%20we%20moved%20the%20king%20*%2F%0A%20%20%20%20%20%20if%20(board%5Bmove.to%5D.type%20%3D%3D%3D%20KING)%20%7B%0A%20%20%20%20%20%20%20%20kings%5Bboard%5Bmove.to%5D.color%5D%20%3D%20move.to%0A%0A%20%20%20%20%20%20%20%20%2F*%20if%20we%20castled%2C%20move%20the%20rook%20next%20to%20the%20king%20*%2F%0A%20%20%20%20%20%20%20%20if%20(move.flags%20%26%20BITS.KSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20castling_to%20%3D%20move.to%20-%201%0A%20%20%20%20%20%20%20%20%20%20var%20castling_from%20%3D%20move.to%20%2B%201%0A%20%20%20%20%20%20%20%20%20%20board%5Bcastling_to%5D%20%3D%20board%5Bcastling_from%5D%0A%20%20%20%20%20%20%20%20%20%20board%5Bcastling_from%5D%20%3D%20null%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(move.flags%20%26%20BITS.QSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20castling_to%20%3D%20move.to%20%2B%201%0A%20%20%20%20%20%20%20%20%20%20var%20castling_from%20%3D%20move.to%20-%202%0A%20%20%20%20%20%20%20%20%20%20board%5Bcastling_to%5D%20%3D%20board%5Bcastling_from%5D%0A%20%20%20%20%20%20%20%20%20%20board%5Bcastling_from%5D%20%3D%20null%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20turn%20off%20castling%20*%2F%0A%20%20%20%20%20%20%20%20castling%5Bus%5D%20%3D%20''%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20turn%20off%20castling%20if%20we%20move%20a%20rook%20*%2F%0A%20%20%20%20%20%20if%20(castling%5Bus%5D)%20%7B%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20ROOKS%5Bus%5D.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20move.from%20%3D%3D%3D%20ROOKS%5Bus%5D%5Bi%5D.square%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20castling%5Bus%5D%20%26%20ROOKS%5Bus%5D%5Bi%5D.flag%0A%20%20%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20castling%5Bus%5D%20%5E%3D%20ROOKS%5Bus%5D%5Bi%5D.flag%0A%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20turn%20off%20castling%20if%20we%20capture%20a%20rook%20*%2F%0A%20%20%20%20%20%20if%20(castling%5Bthem%5D)%20%7B%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20ROOKS%5Bthem%5D.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20move.to%20%3D%3D%3D%20ROOKS%5Bthem%5D%5Bi%5D.square%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20castling%5Bthem%5D%20%26%20ROOKS%5Bthem%5D%5Bi%5D.flag%0A%20%20%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20castling%5Bthem%5D%20%5E%3D%20ROOKS%5Bthem%5D%5Bi%5D.flag%0A%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20if%20big%20pawn%20move%2C%20update%20the%20en%20passant%20square%20*%2F%0A%20%20%20%20%20%20if%20(move.flags%20%26%20BITS.BIG_PAWN)%20%7B%0A%20%20%20%20%20%20%20%20if%20(turn%20%3D%3D%3D%20'b')%20%7B%0A%20%20%20%20%20%20%20%20%20%20ep_square%20%3D%20move.to%20-%2016%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20ep_square%20%3D%20move.to%20%2B%2016%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20ep_square%20%3D%20EMPTY%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%2F*%20reset%20the%2050%20move%20counter%20if%20a%20pawn%20is%20moved%20or%20a%20piece%20is%20captured%20*%2F%0A%20%20%20%20%20%20if%20(move.piece%20%3D%3D%3D%20PAWN)%20%7B%0A%20%20%20%20%20%20%20%20half_moves%20%3D%200%0A%20%20%20%20%20%20%7D%20else%20if%20(move.flags%20%26%20(BITS.CAPTURE%20%7C%20BITS.EP_CAPTURE))%20%7B%0A%20%20%20%20%20%20%20%20half_moves%20%3D%200%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20half_moves%2B%2B%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20(turn%20%3D%3D%3D%20BLACK)%20%7B%0A%20%20%20%20%20%20%20%20move_number%2B%2B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20turn%20%3D%20swap_color(turn)%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20undo_move()%20%7B%0A%20%20%20%20%20%20var%20old%20%3D%20history.pop()%0A%20%20%20%20%20%20if%20(old%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20return%20null%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20move%20%3D%20old.move%0A%20%20%20%20%20%20kings%20%3D%20old.kings%0A%20%20%20%20%20%20turn%20%3D%20old.turn%0A%20%20%20%20%20%20castling%20%3D%20old.castling%0A%20%20%20%20%20%20ep_square%20%3D%20old.ep_square%0A%20%20%20%20%20%20half_moves%20%3D%20old.half_moves%0A%20%20%20%20%20%20move_number%20%3D%20old.move_number%0A%0A%20%20%20%20%20%20var%20us%20%3D%20turn%0A%20%20%20%20%20%20var%20them%20%3D%20swap_color(turn)%0A%0A%20%20%20%20%20%20board%5Bmove.from%5D%20%3D%20board%5Bmove.to%5D%0A%20%20%20%20%20%20board%5Bmove.from%5D.type%20%3D%20move.piece%20%2F%2F%20to%20undo%20any%20promotions%0A%20%20%20%20%20%20board%5Bmove.to%5D%20%3D%20null%0A%0A%20%20%20%20%20%20if%20(move.flags%20%26%20BITS.CAPTURE)%20%7B%0A%20%20%20%20%20%20%20%20board%5Bmove.to%5D%20%3D%20%7B%20type%3A%20move.captured%2C%20color%3A%20them%20%7D%0A%20%20%20%20%20%20%7D%20else%20if%20(move.flags%20%26%20BITS.EP_CAPTURE)%20%7B%0A%20%20%20%20%20%20%20%20var%20index%0A%20%20%20%20%20%20%20%20if%20(us%20%3D%3D%3D%20BLACK)%20%7B%0A%20%20%20%20%20%20%20%20%20%20index%20%3D%20move.to%20-%2016%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20index%20%3D%20move.to%20%2B%2016%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20board%5Bindex%5D%20%3D%20%7B%20type%3A%20PAWN%2C%20color%3A%20them%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20(move.flags%20%26%20(BITS.KSIDE_CASTLE%20%7C%20BITS.QSIDE_CASTLE))%20%7B%0A%20%20%20%20%20%20%20%20var%20castling_to%2C%20castling_from%0A%20%20%20%20%20%20%20%20if%20(move.flags%20%26%20BITS.KSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20%20%20castling_to%20%3D%20move.to%20%2B%201%0A%20%20%20%20%20%20%20%20%20%20castling_from%20%3D%20move.to%20-%201%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(move.flags%20%26%20BITS.QSIDE_CASTLE)%20%7B%0A%20%20%20%20%20%20%20%20%20%20castling_to%20%3D%20move.to%20-%202%0A%20%20%20%20%20%20%20%20%20%20castling_from%20%3D%20move.to%20%2B%201%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20board%5Bcastling_to%5D%20%3D%20board%5Bcastling_from%5D%0A%20%20%20%20%20%20%20%20board%5Bcastling_from%5D%20%3D%20null%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20move%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F*%20this%20function%20is%20used%20to%20uniquely%20identify%20ambiguous%20moves%20*%2F%0A%20%20%20%20function%20get_disambiguator(move%2C%20moves)%20%7B%0A%20%20%20%20%20%20var%20from%20%3D%20move.from%0A%20%20%20%20%20%20var%20to%20%3D%20move.to%0A%20%20%20%20%20%20var%20piece%20%3D%20move.piece%0A%0A%20%20%20%20%20%20var%20ambiguities%20%3D%200%0A%20%20%20%20%20%20var%20same_rank%20%3D%200%0A%20%20%20%20%20%20var%20same_file%20%3D%200%0A%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20moves.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20var%20ambig_from%20%3D%20moves%5Bi%5D.from%0A%20%20%20%20%20%20%20%20var%20ambig_to%20%3D%20moves%5Bi%5D.to%0A%20%20%20%20%20%20%20%20var%20ambig_piece%20%3D%20moves%5Bi%5D.piece%0A%0A%20%20%20%20%20%20%20%20%2F*%20if%20a%20move%20of%20the%20same%20piece%20type%20ends%20on%20the%20same%20to%20square%2C%20we'll%0A%20%20%20%20%20%20%20%20%20*%20need%20to%20add%20a%20disambiguator%20to%20the%20algebraic%20notation%0A%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20if%20(piece%20%3D%3D%3D%20ambig_piece%20%26%26%20from%20!%3D%3D%20ambig_from%20%26%26%20to%20%3D%3D%3D%20ambig_to)%20%7B%0A%20%20%20%20%20%20%20%20%20%20ambiguities%2B%2B%0A%0A%20%20%20%20%20%20%20%20%20%20if%20(rank(from)%20%3D%3D%3D%20rank(ambig_from))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20same_rank%2B%2B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20if%20(file(from)%20%3D%3D%3D%20file(ambig_from))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20same_file%2B%2B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20if%20(ambiguities%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20if%20there%20exists%20a%20similar%20moving%20piece%20on%20the%20same%20rank%20and%20file%20as%0A%20%20%20%20%20%20%20%20%20*%20the%20move%20in%20question%2C%20use%20the%20square%20as%20the%20disambiguator%0A%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20if%20(same_rank%20%3E%200%20%26%26%20same_file%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20algebraic(from)%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(same_file%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F*%20if%20the%20moving%20piece%20rests%20on%20the%20same%20file%2C%20use%20the%20rank%20symbol%20as%20the%0A%20%20%20%20%20%20%20%20%20%20%20*%20disambiguator%0A%20%20%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20%20%20return%20algebraic(from).charAt(1)%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F*%20else%20use%20the%20file%20symbol%20*%2F%0A%20%20%20%20%20%20%20%20%20%20return%20algebraic(from).charAt(0)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20''%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20infer_piece_type(san)%20%7B%0A%20%20%20%20%20%20var%20piece_type%20%3D%20san.charAt(0)%0A%20%20%20%20%20%20if%20(piece_type%20%3E%3D%20'a'%20%26%26%20piece_type%20%3C%3D%20'h')%20%7B%0A%20%20%20%20%20%20%20%20var%20matches%20%3D%20san.match(%2F%5Ba-h%5D%5Cd.*%5Ba-h%5D%5Cd%2F)%0A%20%20%20%20%20%20%20%20if%20(matches)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20undefined%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20PAWN%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20piece_type%20%3D%20piece_type.toLowerCase()%0A%20%20%20%20%20%20if%20(piece_type%20%3D%3D%3D%20'o')%20%7B%0A%20%20%20%20%20%20%20%20return%20KING%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20return%20piece_type%0A%20%20%20%20%7D%0A%20%20%20%20function%20ascii()%20%7B%0A%20%20%20%20%20%20var%20s%20%3D%20'%20%20%20%2B------------------------%2B%5Cn'%0A%20%20%20%20%20%20for%20(var%20i%20%3D%20SQUARES.a8%3B%20i%20%3C%3D%20SQUARES.h1%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20display%20the%20rank%20*%2F%0A%20%20%20%20%20%20%20%20if%20(file(i)%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20s%20%2B%3D%20'%20'%20%2B%20'87654321'%5Brank(i)%5D%20%2B%20'%20%7C'%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20empty%20piece%20*%2F%0A%20%20%20%20%20%20%20%20if%20(board%5Bi%5D%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20s%20%2B%3D%20'%20.%20'%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20piece%20%3D%20board%5Bi%5D.type%0A%20%20%20%20%20%20%20%20%20%20var%20color%20%3D%20board%5Bi%5D.color%0A%20%20%20%20%20%20%20%20%20%20var%20symbol%20%3D%20color%20%3D%3D%3D%20WHITE%20%3F%20piece.toUpperCase()%20%3A%20piece.toLowerCase()%0A%20%20%20%20%20%20%20%20%20%20s%20%2B%3D%20'%20'%20%2B%20symbol%20%2B%20'%20'%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20((i%20%2B%201)%20%26%200x88)%20%7B%0A%20%20%20%20%20%20%20%20%20%20s%20%2B%3D%20'%7C%5Cn'%0A%20%20%20%20%20%20%20%20%20%20i%20%2B%3D%208%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20s%20%2B%3D%20'%20%20%20%2B------------------------%2B%5Cn'%0A%20%20%20%20%20%20s%20%2B%3D%20'%20%20%20%20%20a%20%20b%20%20c%20%20d%20%20e%20%20f%20%20g%20%20h%5Cn'%0A%0A%20%20%20%20%20%20return%20s%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F%2F%20convert%20a%20move%20from%20Standard%20Algebraic%20Notation%20(SAN)%20to%200x88%20coordinates%0A%20%20%20%20function%20move_from_san(move%2C%20sloppy)%20%7B%0A%20%20%20%20%20%20%2F%2F%20strip%20off%20any%20move%20decorations%3A%20e.g%20Nf3%2B%3F!%20becomes%20Nf3%0A%20%20%20%20%20%20var%20clean_move%20%3D%20stripped_san(move)%0A%0A%20%20%20%20%20%20var%20overly_disambiguated%20%3D%20false%0A%0A%20%20%20%20%20%20if%20(sloppy)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20The%20sloppy%20parser%20allows%20the%20user%20to%20parse%20non-standard%20chess%0A%20%20%20%20%20%20%20%20%2F%2F%20notations.%20This%20parser%20is%20opt-in%20(by%20specifying%20the%0A%20%20%20%20%20%20%20%20%2F%2F%20'%7B%20sloppy%3A%20true%20%7D'%20setting)%20and%20is%20only%20run%20after%20the%20Standard%0A%20%20%20%20%20%20%20%20%2F%2F%20Algebraic%20Notation%20(SAN)%20parser%20has%20failed.%0A%20%20%20%20%20%20%20%20%2F%2F%0A%20%20%20%20%20%20%20%20%2F%2F%20When%20running%20the%20sloppy%20parser%2C%20we'll%20run%20a%20regex%20to%20grab%20the%20piece%2C%0A%20%20%20%20%20%20%20%20%2F%2F%20the%20to%2Ffrom%20square%2C%20and%20an%20optional%20promotion%20piece.%20This%20regex%20will%0A%20%20%20%20%20%20%20%20%2F%2F%20parse%20common%20non-standard%20notation%20like%3A%20Pe2-e4%2C%20Rc1c4%2C%20Qf3xf7%2C%20f7f8q%2C%0A%20%20%20%20%20%20%20%20%2F%2F%20b1c3%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20NOTE%3A%20Some%20positions%20and%20moves%20may%20be%20ambiguous%20when%20using%20the%20sloppy%0A%20%20%20%20%20%20%20%20%2F%2F%20parser.%20For%20example%2C%20in%20this%20position%3A%206k1%2F8%2F8%2FB7%2F8%2F8%2F8%2FBN4K1%20w%20-%20-%200%201%2C%0A%20%20%20%20%20%20%20%20%2F%2F%20the%20move%20b1c3%20may%20be%20interpreted%20as%20Nc3%20or%20B1c3%20(a%20disambiguated%0A%20%20%20%20%20%20%20%20%2F%2F%20bishop%20move).%20In%20these%20cases%2C%20the%20sloppy%20parser%20will%20default%20to%20the%0A%20%20%20%20%20%20%20%20%2F%2F%20most%20most%20basic%20interpretation%20-%20b1c3%20parses%20to%20Nc3.%0A%0A%20%20%20%20%20%20%20%20var%20matches%20%3D%20clean_move.match(%0A%20%20%20%20%20%20%20%20%20%20%2F(%5BpnbrqkPNBRQK%5D)%3F(%5Ba-h%5D%5B1-8%5D)x%3F-%3F(%5Ba-h%5D%5B1-8%5D)(%5BqrbnQRBN%5D)%3F%2F%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20if%20(matches)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20piece%20%3D%20matches%5B1%5D%0A%20%20%20%20%20%20%20%20%20%20var%20from%20%3D%20matches%5B2%5D%0A%20%20%20%20%20%20%20%20%20%20var%20to%20%3D%20matches%5B3%5D%0A%20%20%20%20%20%20%20%20%20%20var%20promotion%20%3D%20matches%5B4%5D%0A%0A%20%20%20%20%20%20%20%20%20%20if%20(from.length%20%3D%3D%201)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20overly_disambiguated%20%3D%20true%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20The%20%5Ba-h%5D%3F%5B1-8%5D%3F%20portion%20of%20the%20regex%20below%20handles%20moves%20that%20may%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20be%20overly%20disambiguated%20(e.g.%20Nge7%20is%20unnecessary%20and%20non-standard%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20when%20there%20is%20one%20legal%20knight%20move%20to%20e7).%20In%20this%20case%2C%20the%20value%0A%20%20%20%20%20%20%20%20%20%20%2F%2F%20of%20'from'%20variable%20will%20be%20a%20rank%20or%20file%2C%20not%20a%20square.%0A%20%20%20%20%20%20%20%20%20%20var%20matches%20%3D%20clean_move.match(%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F(%5BpnbrqkPNBRQK%5D)%3F(%5Ba-h%5D%3F%5B1-8%5D%3F)x%3F-%3F(%5Ba-h%5D%5B1-8%5D)(%5BqrbnQRBN%5D)%3F%2F%0A%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20if%20(matches)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20piece%20%3D%20matches%5B1%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20from%20%3D%20matches%5B2%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20to%20%3D%20matches%5B3%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20promotion%20%3D%20matches%5B4%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(from.length%20%3D%3D%201)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20overly_disambiguated%20%3D%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20var%20piece_type%20%3D%20infer_piece_type(clean_move)%0A%20%20%20%20%20%20var%20moves%20%3D%20generate_moves(%7B%0A%20%20%20%20%20%20%20%20legal%3A%20true%2C%0A%20%20%20%20%20%20%20%20piece%3A%20piece%20%3F%20piece%20%3A%20piece_type%2C%0A%20%20%20%20%20%20%7D)%0A%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20moves.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20try%20the%20strict%20parser%20first%2C%20then%20the%20sloppy%20parser%20if%20requested%0A%20%20%20%20%20%20%20%20%2F%2F%20by%20the%20user%0A%20%20%20%20%20%20%20%20if%20(clean_move%20%3D%3D%3D%20stripped_san(move_to_san(moves%5Bi%5D%2C%20moves)))%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20moves%5Bi%5D%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(sloppy%20%26%26%20matches)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20hand-compare%20move%20properties%20with%20the%20results%20from%20our%20sloppy%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20regex%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20(!piece%20%7C%7C%20piece.toLowerCase()%20%3D%3D%20moves%5Bi%5D.piece)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20SQUARES%5Bfrom%5D%20%3D%3D%20moves%5Bi%5D.from%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20SQUARES%5Bto%5D%20%3D%3D%20moves%5Bi%5D.to%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20(!promotion%20%7C%7C%20promotion.toLowerCase()%20%3D%3D%20moves%5Bi%5D.promotion)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20moves%5Bi%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(overly_disambiguated)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20SPECIAL%20CASE%3A%20we%20parsed%20a%20move%20string%20that%20may%20have%20an%20unneeded%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20rank%2Ffile%20disambiguator%20(e.g.%20Nge7).%20%20The%20'from'%20variable%20will%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20square%20%3D%20algebraic(moves%5Bi%5D.from)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(!piece%20%7C%7C%20piece.toLowerCase()%20%3D%3D%20moves%5Bi%5D.piece)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20SQUARES%5Bto%5D%20%3D%3D%20moves%5Bi%5D.to%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(from%20%3D%3D%20square%5B0%5D%20%7C%7C%20from%20%3D%3D%20square%5B1%5D)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20(!promotion%20%7C%7C%20promotion.toLowerCase()%20%3D%3D%20moves%5Bi%5D.promotion)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20moves%5Bi%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20null%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F*****************************************************************************%0A%20%20%20%20%20*%20UTILITY%20FUNCTIONS%0A%20%20%20%20%20****************************************************************************%2F%0A%20%20%20%20function%20rank(i)%20%7B%0A%20%20%20%20%20%20return%20i%20%3E%3E%204%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20file(i)%20%7B%0A%20%20%20%20%20%20return%20i%20%26%2015%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20algebraic(i)%20%7B%0A%20%20%20%20%20%20var%20f%20%3D%20file(i)%2C%0A%20%20%20%20%20%20%20%20r%20%3D%20rank(i)%0A%20%20%20%20%20%20return%20'abcdefgh'.substring(f%2C%20f%20%2B%201)%20%2B%20'87654321'.substring(r%2C%20r%20%2B%201)%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20swap_color(c)%20%7B%0A%20%20%20%20%20%20return%20c%20%3D%3D%3D%20WHITE%20%3F%20BLACK%20%3A%20WHITE%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20is_digit(c)%20%7B%0A%20%20%20%20%20%20return%20'0123456789'.indexOf(c)%20!%3D%3D%20-1%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F*%20pretty%20%3D%20external%20move%20object%20*%2F%0A%20%20%20%20function%20make_pretty(ugly_move)%20%7B%0A%20%20%20%20%20%20var%20move%20%3D%20clone(ugly_move)%0A%20%20%20%20%20%20move.san%20%3D%20move_to_san(move%2C%20generate_moves(%7B%20legal%3A%20true%20%7D))%0A%20%20%20%20%20%20move.to%20%3D%20algebraic(move.to)%0A%20%20%20%20%20%20move.from%20%3D%20algebraic(move.from)%0A%0A%20%20%20%20%20%20var%20flags%20%3D%20''%0A%0A%20%20%20%20%20%20for%20(var%20flag%20in%20BITS)%20%7B%0A%20%20%20%20%20%20%20%20if%20(BITS%5Bflag%5D%20%26%20move.flags)%20%7B%0A%20%20%20%20%20%20%20%20%20%20flags%20%2B%3D%20FLAGS%5Bflag%5D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20move.flags%20%3D%20flags%0A%0A%20%20%20%20%20%20return%20move%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20clone(obj)%20%7B%0A%20%20%20%20%20%20var%20dupe%20%3D%20obj%20instanceof%20Array%20%3F%20%5B%5D%20%3A%20%7B%7D%0A%0A%20%20%20%20%20%20for%20(var%20property%20in%20obj)%20%7B%0A%20%20%20%20%20%20%20%20if%20(typeof%20property%20%3D%3D%3D%20'object')%20%7B%0A%20%20%20%20%20%20%20%20%20%20dupe%5Bproperty%5D%20%3D%20clone(obj%5Bproperty%5D)%0A%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20dupe%5Bproperty%5D%20%3D%20obj%5Bproperty%5D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20dupe%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20trim(str)%20%7B%0A%20%20%20%20%20%20return%20str.replace(%2F%5E%5Cs%2B%7C%5Cs%2B%24%2Fg%2C%20'')%0A%20%20%20%20%7D%0A%0A%20%20%20%20%2F*****************************************************************************%0A%20%20%20%20%20*%20DEBUGGING%20UTILITIES%0A%20%20%20%20%20****************************************************************************%2F%0A%20%20%20%20function%20perft(depth)%20%7B%0A%20%20%20%20%20%20var%20moves%20%3D%20generate_moves(%7B%20legal%3A%20false%20%7D)%0A%20%20%20%20%20%20var%20nodes%20%3D%200%0A%20%20%20%20%20%20var%20color%20%3D%20turn%0A%0A%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20moves.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20make_move(moves%5Bi%5D)%0A%20%20%20%20%20%20%20%20if%20(!king_attacked(color))%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(depth%20-%201%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20child_nodes%20%3D%20perft(depth%20-%201)%0A%20%20%20%20%20%20%20%20%20%20%20%20nodes%20%2B%3D%20child_nodes%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20nodes%2B%2B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20undo_move()%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20nodes%0A%20%20%20%20%7D%0A%0A%20%20%20%20return%20%7B%0A%20%20%20%20%20%20%2F***************************************************************************%0A%20%20%20%20%20%20%20*%20PUBLIC%20CONSTANTS%20(is%20there%20a%20better%20way%20to%20do%20this%3F)%0A%20%20%20%20%20%20%20**************************************************************************%2F%0A%20%20%20%20%20%20WHITE%3A%20WHITE%2C%0A%20%20%20%20%20%20BLACK%3A%20BLACK%2C%0A%20%20%20%20%20%20PAWN%3A%20PAWN%2C%0A%20%20%20%20%20%20KNIGHT%3A%20KNIGHT%2C%0A%20%20%20%20%20%20BISHOP%3A%20BISHOP%2C%0A%20%20%20%20%20%20ROOK%3A%20ROOK%2C%0A%20%20%20%20%20%20QUEEN%3A%20QUEEN%2C%0A%20%20%20%20%20%20KING%3A%20KING%2C%0A%20%20%20%20%20%20SQUARES%3A%20(function%20()%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20from%20the%20ECMA-262%20spec%20(section%2012.6.4)%3A%0A%20%20%20%20%20%20%20%20%20*%20%22The%20mechanics%20of%20enumerating%20the%20properties%20...%20is%0A%20%20%20%20%20%20%20%20%20*%20implementation%20dependent%22%0A%20%20%20%20%20%20%20%20%20*%20so%3A%20for%20(var%20sq%20in%20SQUARES)%20%7B%20keys.push(sq)%3B%20%7D%20might%20not%20be%0A%20%20%20%20%20%20%20%20%20*%20ordered%20correctly%0A%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20var%20keys%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%20SQUARES.a8%3B%20i%20%3C%3D%20SQUARES.h1%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(i%20%26%200x88)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20i%20%2B%3D%207%0A%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20keys.push(algebraic(i))%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20keys%0A%20%20%20%20%20%20%7D)()%2C%0A%20%20%20%20%20%20FLAGS%3A%20FLAGS%2C%0A%0A%20%20%20%20%20%20%2F***************************************************************************%0A%20%20%20%20%20%20%20*%20PUBLIC%20API%0A%20%20%20%20%20%20%20**************************************************************************%2F%0A%20%20%20%20%20%20load%3A%20function%20(fen)%20%7B%0A%20%20%20%20%20%20%20%20return%20load(fen)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20reset%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20reset()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20moves%3A%20function%20(options)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20The%20internal%20representation%20of%20a%20chess%20move%20is%20in%200x88%20format%2C%20and%0A%20%20%20%20%20%20%20%20%20*%20not%20meant%20to%20be%20human-readable.%20%20The%20code%20below%20converts%20the%200x88%0A%20%20%20%20%20%20%20%20%20*%20square%20coordinates%20to%20algebraic%20coordinates.%20%20It%20also%20prunes%20an%0A%20%20%20%20%20%20%20%20%20*%20unnecessary%20move%20keys%20resulting%20from%20a%20verbose%20call.%0A%20%20%20%20%20%20%20%20%20*%2F%0A%0A%20%20%20%20%20%20%20%20var%20ugly_moves%20%3D%20generate_moves(options)%0A%20%20%20%20%20%20%20%20var%20moves%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20ugly_moves.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F*%20does%20the%20user%20want%20a%20full%20move%20object%20(most%20likely%20not)%2C%20or%20just%0A%20%20%20%20%20%20%20%20%20%20%20*%20SAN%0A%20%20%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20typeof%20options%20!%3D%3D%20'undefined'%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20'verbose'%20in%20options%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20options.verbose%0A%20%20%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20moves.push(make_pretty(ugly_moves%5Bi%5D))%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20moves.push(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20move_to_san(ugly_moves%5Bi%5D%2C%20generate_moves(%7B%20legal%3A%20true%20%7D))%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20return%20moves%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20in_check%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20in_check()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20in_checkmate%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20in_checkmate()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20in_stalemate%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20in_stalemate()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20in_draw%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20%20%20half_moves%20%3E%3D%20100%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20in_stalemate()%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20insufficient_material()%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20in_threefold_repetition()%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20insufficient_material%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20insufficient_material()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20in_threefold_repetition%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20in_threefold_repetition()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20game_over%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20%20%20half_moves%20%3E%3D%20100%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20in_checkmate()%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20in_stalemate()%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20insufficient_material()%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20in_threefold_repetition()%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20validate_fen%3A%20function%20(fen)%20%7B%0A%20%20%20%20%20%20%20%20return%20validate_fen(fen)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20fen%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20generate_fen()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20board%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20var%20output%20%3D%20%5B%5D%2C%0A%20%20%20%20%20%20%20%20%20%20row%20%3D%20%5B%5D%0A%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%20SQUARES.a8%3B%20i%20%3C%3D%20SQUARES.h1%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(board%5Bi%5D%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20row.push(null)%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20row.push(%7B%20type%3A%20board%5Bi%5D.type%2C%20color%3A%20board%5Bi%5D.color%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20if%20((i%20%2B%201)%20%26%200x88)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20output.push(row)%0A%20%20%20%20%20%20%20%20%20%20%20%20row%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20i%20%2B%3D%208%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20return%20output%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20pgn%3A%20function%20(options)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20using%20the%20specification%20from%20http%3A%2F%2Fwww.chessclub.com%2Fhelp%2FPGN-spec%0A%20%20%20%20%20%20%20%20%20*%20example%20for%20html%20usage%3A%20.pgn(%7B%20max_width%3A%2072%2C%20newline_char%3A%20%22%3Cbr%20%2F%3E%22%20%7D)%0A%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20var%20newline%20%3D%0A%20%20%20%20%20%20%20%20%20%20typeof%20options%20%3D%3D%3D%20'object'%20%26%26%20typeof%20options.newline_char%20%3D%3D%3D%20'string'%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20options.newline_char%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%20'%5Cn'%0A%20%20%20%20%20%20%20%20var%20max_width%20%3D%0A%20%20%20%20%20%20%20%20%20%20typeof%20options%20%3D%3D%3D%20'object'%20%26%26%20typeof%20options.max_width%20%3D%3D%3D%20'number'%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20options.max_width%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%200%0A%20%20%20%20%20%20%20%20var%20result%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20var%20header_exists%20%3D%20false%0A%0A%20%20%20%20%20%20%20%20%2F*%20add%20the%20PGN%20header%20headerrmation%20*%2F%0A%20%20%20%20%20%20%20%20for%20(var%20i%20in%20header)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%2F*%20TODO%3A%20order%20of%20enumerated%20properties%20in%20header%20object%20is%20not%0A%20%20%20%20%20%20%20%20%20%20%20*%20guaranteed%2C%20see%20ECMA-262%20spec%20(section%2012.6.4)%0A%20%20%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20%20%20result.push('%5B'%20%2B%20i%20%2B%20'%20%22'%20%2B%20header%5Bi%5D%20%2B%20'%22%5D'%20%2B%20newline)%0A%20%20%20%20%20%20%20%20%20%20header_exists%20%3D%20true%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20if%20(header_exists%20%26%26%20history.length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20result.push(newline)%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20append_comment%20%3D%20function%20(move_string)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20comment%20%3D%20comments%5Bgenerate_fen()%5D%0A%20%20%20%20%20%20%20%20%20%20if%20(typeof%20comment%20!%3D%3D%20'undefined')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20delimiter%20%3D%20move_string.length%20%3E%200%20%3F%20'%20'%20%3A%20''%0A%20%20%20%20%20%20%20%20%20%20%20%20move_string%20%3D%20%60%24%7Bmove_string%7D%24%7Bdelimiter%7D%7B%24%7Bcomment%7D%7D%60%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20return%20move_string%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20pop%20all%20of%20history%20onto%20reversed_history%20*%2F%0A%20%20%20%20%20%20%20%20var%20reversed_history%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20while%20(history.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20reversed_history.push(undo_move())%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20moves%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20var%20move_string%20%3D%20''%0A%0A%20%20%20%20%20%20%20%20%2F*%20special%20case%20of%20a%20commented%20starting%20position%20with%20no%20moves%20*%2F%0A%20%20%20%20%20%20%20%20if%20(reversed_history.length%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20moves.push(append_comment(''))%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20build%20the%20list%20of%20moves.%20%20a%20move_string%20looks%20like%3A%20%223.%20e3%20e6%22%20*%2F%0A%20%20%20%20%20%20%20%20while%20(reversed_history.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20move_string%20%3D%20append_comment(move_string)%0A%20%20%20%20%20%20%20%20%20%20var%20move%20%3D%20reversed_history.pop()%0A%0A%20%20%20%20%20%20%20%20%20%20%2F*%20if%20the%20position%20started%20with%20black%20to%20move%2C%20start%20PGN%20with%201.%20...%20*%2F%0A%20%20%20%20%20%20%20%20%20%20if%20(!history.length%20%26%26%20move.color%20%3D%3D%3D%20'b')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20move_string%20%3D%20move_number%20%2B%20'.%20...'%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(move.color%20%3D%3D%3D%20'w')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F*%20store%20the%20previous%20generated%20move_string%20if%20we%20have%20one%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(move_string.length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20moves.push(move_string)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20move_string%20%3D%20move_number%20%2B%20'.'%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20move_string%20%3D%0A%20%20%20%20%20%20%20%20%20%20%20%20move_string%20%2B%20'%20'%20%2B%20move_to_san(move%2C%20generate_moves(%7B%20legal%3A%20true%20%7D))%0A%20%20%20%20%20%20%20%20%20%20make_move(move)%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20are%20there%20any%20other%20leftover%20moves%3F%20*%2F%0A%20%20%20%20%20%20%20%20if%20(move_string.length)%20%7B%0A%20%20%20%20%20%20%20%20%20%20moves.push(append_comment(move_string))%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20is%20there%20a%20result%3F%20*%2F%0A%20%20%20%20%20%20%20%20if%20(typeof%20header.Result%20!%3D%3D%20'undefined')%20%7B%0A%20%20%20%20%20%20%20%20%20%20moves.push(header.Result)%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20history%20should%20be%20back%20to%20what%20it%20was%20before%20we%20started%20generating%20PGN%2C%0A%20%20%20%20%20%20%20%20%20*%20so%20join%20together%20moves%0A%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20if%20(max_width%20%3D%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20result.join('')%20%2B%20moves.join('%20')%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20strip%20%3D%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(result.length%20%3E%200%20%26%26%20result%5Bresult.length%20-%201%5D%20%3D%3D%3D%20'%20')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20result.pop()%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20true%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20NB%3A%20this%20does%20not%20preserve%20comment%20whitespace.%20*%2F%0A%20%20%20%20%20%20%20%20var%20wrap_comment%20%3D%20function%20(width%2C%20move)%20%7B%0A%20%20%20%20%20%20%20%20%20%20for%20(var%20token%20of%20move.split('%20'))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!token)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(width%20%2B%20token.length%20%3E%20max_width)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20while%20(strip())%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20width--%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.push(newline)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20width%20%3D%200%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20result.push(token)%0A%20%20%20%20%20%20%20%20%20%20%20%20width%20%2B%3D%20token.length%0A%20%20%20%20%20%20%20%20%20%20%20%20result.push('%20')%0A%20%20%20%20%20%20%20%20%20%20%20%20width%2B%2B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20if%20(strip())%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20width--%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20return%20width%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20wrap%20the%20PGN%20output%20at%20max_width%20*%2F%0A%20%20%20%20%20%20%20%20var%20current_width%20%3D%200%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20moves.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(current_width%20%2B%20moves%5Bi%5D.length%20%3E%20max_width)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(moves%5Bi%5D.includes('%7B'))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20current_width%20%3D%20wrap_comment(current_width%2C%20moves%5Bi%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%2F*%20if%20the%20current%20move%20will%20push%20past%20max_width%20*%2F%0A%20%20%20%20%20%20%20%20%20%20if%20(current_width%20%2B%20moves%5Bi%5D.length%20%3E%20max_width%20%26%26%20i%20!%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F*%20don't%20end%20the%20line%20with%20whitespace%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(result%5Bresult.length%20-%201%5D%20%3D%3D%3D%20'%20')%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.pop()%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20result.push(newline)%0A%20%20%20%20%20%20%20%20%20%20%20%20current_width%20%3D%200%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(i%20!%3D%3D%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20result.push('%20')%0A%20%20%20%20%20%20%20%20%20%20%20%20current_width%2B%2B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20result.push(moves%5Bi%5D)%0A%20%20%20%20%20%20%20%20%20%20current_width%20%2B%3D%20moves%5Bi%5D.length%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20return%20result.join('')%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20load_pgn%3A%20function%20(pgn%2C%20options)%20%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20allow%20the%20user%20to%20specify%20the%20sloppy%20move%20parser%20to%20work%20around%20over%0A%20%20%20%20%20%20%20%20%2F%2F%20disambiguation%20bugs%20in%20Fritz%20and%20Chessbase%0A%20%20%20%20%20%20%20%20var%20sloppy%20%3D%0A%20%20%20%20%20%20%20%20%20%20typeof%20options%20!%3D%3D%20'undefined'%20%26%26%20'sloppy'%20in%20options%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20options.sloppy%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%20false%0A%0A%20%20%20%20%20%20%20%20function%20mask(str)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20str.replace(%2F%5C%5C%2Fg%2C%20'%5C%5C')%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20function%20has_keys(object)%20%7B%0A%20%20%20%20%20%20%20%20%20%20for%20(var%20key%20in%20object)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20true%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20function%20parse_pgn_header(header%2C%20options)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20newline_char%20%3D%0A%20%20%20%20%20%20%20%20%20%20%20%20typeof%20options%20%3D%3D%3D%20'object'%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20typeof%20options.newline_char%20%3D%3D%3D%20'string'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3F%20options.newline_char%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20'%5Cr%3F%5Cn'%0A%20%20%20%20%20%20%20%20%20%20var%20header_obj%20%3D%20%7B%7D%0A%20%20%20%20%20%20%20%20%20%20var%20headers%20%3D%20header.split(new%20RegExp(mask(newline_char)))%0A%20%20%20%20%20%20%20%20%20%20var%20key%20%3D%20''%0A%20%20%20%20%20%20%20%20%20%20var%20value%20%3D%20''%0A%0A%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%20%3C%20headers.length%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20key%20%3D%20headers%5Bi%5D.replace(%2F%5E%5C%5B(%5BA-Z%5D%5BA-Za-z%5D*)%5Cs.*%5C%5D%24%2F%2C%20'%241')%0A%20%20%20%20%20%20%20%20%20%20%20%20value%20%3D%20headers%5Bi%5D.replace(%2F%5E%5C%5B%5BA-Za-z%5D%2B%5Cs%22(.*)%22%5C%20*%5C%5D%24%2F%2C%20'%241')%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(trim(key).length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20header_obj%5Bkey%5D%20%3D%20value%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20return%20header_obj%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20newline_char%20%3D%0A%20%20%20%20%20%20%20%20%20%20typeof%20options%20%3D%3D%3D%20'object'%20%26%26%20typeof%20options.newline_char%20%3D%3D%3D%20'string'%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20options.newline_char%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%20'%5Cr%3F%5Cn'%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20RegExp%20to%20split%20header.%20Takes%20advantage%20of%20the%20fact%20that%20header%20and%20movetext%0A%20%20%20%20%20%20%20%20%2F%2F%20will%20always%20have%20a%20blank%20line%20between%20them%20(ie%2C%20two%20newline_char's).%0A%20%20%20%20%20%20%20%20%2F%2F%20With%20default%20newline_char%2C%20will%20equal%3A%20%2F%5E(%5C%5B((%3F%3A%5Cr%3F%5Cn)%7C.)*%5C%5D)(%3F%3A%5Cr%3F%5Cn)%7B2%7D%2F%0A%20%20%20%20%20%20%20%20var%20header_regex%20%3D%20new%20RegExp(%0A%20%20%20%20%20%20%20%20%20%20'%5E(%5C%5C%5B((%3F%3A'%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20mask(newline_char)%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20')%7C.)*%5C%5C%5D)'%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20'(%3F%3A'%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20mask(newline_char)%20%2B%0A%20%20%20%20%20%20%20%20%20%20%20%20')%7B2%7D'%0A%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20If%20no%20header%20given%2C%20begin%20with%20moves.%0A%20%20%20%20%20%20%20%20var%20header_string%20%3D%20header_regex.test(pgn)%0A%20%20%20%20%20%20%20%20%20%20%3F%20header_regex.exec(pgn)%5B1%5D%0A%20%20%20%20%20%20%20%20%20%20%3A%20''%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20Put%20the%20board%20in%20the%20starting%20position%0A%20%20%20%20%20%20%20%20reset()%0A%0A%20%20%20%20%20%20%20%20%2F*%20parse%20PGN%20header%20*%2F%0A%20%20%20%20%20%20%20%20var%20headers%20%3D%20parse_pgn_header(header_string%2C%20options)%0A%20%20%20%20%20%20%20%20for%20(var%20key%20in%20headers)%20%7B%0A%20%20%20%20%20%20%20%20%20%20set_header(%5Bkey%2C%20headers%5Bkey%5D%5D)%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20load%20the%20starting%20position%20indicated%20by%20%5BSetup%20'1'%5D%20and%0A%20%20%20%20%20%20%20%20%20*%20%5BFEN%20position%5D%20*%2F%0A%20%20%20%20%20%20%20%20if%20(headers%5B'SetUp'%5D%20%3D%3D%3D%20'1')%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(!('FEN'%20in%20headers%20%26%26%20load(headers%5B'FEN'%5D%2C%20true)))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20second%20argument%20to%20load%3A%20don't%20clear%20the%20headers%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20NB%3A%20the%20regexes%20below%20that%20delete%20move%20numbers%2C%20recursive%0A%20%20%20%20%20%20%20%20%20*%20annotations%2C%20and%20numeric%20annotation%20glyphs%20may%20also%20match%0A%20%20%20%20%20%20%20%20%20*%20text%20in%20comments.%20To%20prevent%20this%2C%20we%20transform%20comments%0A%20%20%20%20%20%20%20%20%20*%20by%20hex-encoding%20them%20in%20place%20and%20decoding%20them%20again%20after%0A%20%20%20%20%20%20%20%20%20*%20the%20other%20tokens%20have%20been%20deleted.%0A%20%20%20%20%20%20%20%20%20*%0A%20%20%20%20%20%20%20%20%20*%20While%20the%20spec%20states%20that%20PGN%20files%20should%20be%20ASCII%20encoded%2C%0A%20%20%20%20%20%20%20%20%20*%20we%20use%20%7Ben%2Cde%7DcodeURIComponent%20here%20to%20support%20arbitrary%20UTF8%0A%20%20%20%20%20%20%20%20%20*%20as%20a%20convenience%20for%20modern%20users%20*%2F%0A%0A%20%20%20%20%20%20%20%20var%20to_hex%20%3D%20function%20(string)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20Array.from(string)%0A%20%20%20%20%20%20%20%20%20%20%20%20.map(function%20(c)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F*%20encodeURI%20doesn't%20transform%20most%20ASCII%20characters%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20*%20so%20we%20handle%20these%20ourselves%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20c.charCodeAt(0)%20%3C%20128%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3F%20c.charCodeAt(0).toString(16)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20encodeURIComponent(c).replace(%2F%5C%25%2Fg%2C%20'').toLowerCase()%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20.join('')%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20from_hex%20%3D%20function%20(string)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20string.length%20%3D%3D%200%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20''%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%20decodeURIComponent('%25'%20%2B%20string.match(%2F.%7B1%2C2%7D%2Fg).join('%25'))%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20encode_comment%20%3D%20function%20(string)%20%7B%0A%20%20%20%20%20%20%20%20%20%20string%20%3D%20string.replace(new%20RegExp(mask(newline_char)%2C%20'g')%2C%20'%20')%0A%20%20%20%20%20%20%20%20%20%20return%20%60%7B%24%7Bto_hex(string.slice(1%2C%20string.length%20-%201))%7D%7D%60%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20var%20decode_comment%20%3D%20function%20(string)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(string.startsWith('%7B')%20%26%26%20string.endsWith('%7D'))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20from_hex(string.slice(1%2C%20string.length%20-%201))%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20delete%20header%20to%20get%20the%20moves%20*%2F%0A%20%20%20%20%20%20%20%20var%20ms%20%3D%20pgn%0A%20%20%20%20%20%20%20%20%20%20.replace(header_string%2C%20'')%0A%20%20%20%20%20%20%20%20%20%20.replace(%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F*%20encode%20comments%20so%20they%20don't%20get%20deleted%20below%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20new%20RegExp(%60(%5C%7B%5B%5E%7D%5D*%5C%7D)%2B%3F%7C%3B(%5B%5E%24%7Bmask(newline_char)%7D%5D*)%60%2C%20'g')%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20function%20(match%2C%20bracket%2C%20semicolon)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20bracket%20!%3D%3D%20undefined%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3F%20encode_comment(bracket)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20'%20'%20%2B%20encode_comment(%60%7B%24%7Bsemicolon.slice(1)%7D%7D%60)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20.replace(new%20RegExp(mask(newline_char)%2C%20'g')%2C%20'%20')%0A%0A%20%20%20%20%20%20%20%20%2F*%20delete%20recursive%20annotation%20variations%20*%2F%0A%20%20%20%20%20%20%20%20var%20rav_regex%20%3D%20%2F(%5C(%5B%5E%5C(%5C)%5D%2B%5C))%2B%3F%2Fg%0A%20%20%20%20%20%20%20%20while%20(rav_regex.test(ms))%20%7B%0A%20%20%20%20%20%20%20%20%20%20ms%20%3D%20ms.replace(rav_regex%2C%20'')%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20delete%20move%20numbers%20*%2F%0A%20%20%20%20%20%20%20%20ms%20%3D%20ms.replace(%2F%5Cd%2B%5C.(%5C.%5C.)%3F%2Fg%2C%20'')%0A%0A%20%20%20%20%20%20%20%20%2F*%20delete%20...%20indicating%20black%20to%20move%20*%2F%0A%20%20%20%20%20%20%20%20ms%20%3D%20ms.replace(%2F%5C.%5C.%5C.%2Fg%2C%20'')%0A%0A%20%20%20%20%20%20%20%20%2F*%20delete%20numeric%20annotation%20glyphs%20*%2F%0A%20%20%20%20%20%20%20%20ms%20%3D%20ms.replace(%2F%5C%24%5Cd%2B%2Fg%2C%20'')%0A%0A%20%20%20%20%20%20%20%20%2F*%20trim%20and%20get%20array%20of%20moves%20*%2F%0A%20%20%20%20%20%20%20%20var%20moves%20%3D%20trim(ms).split(new%20RegExp(%2F%5Cs%2B%2F))%0A%0A%20%20%20%20%20%20%20%20%2F*%20delete%20empty%20entries%20*%2F%0A%20%20%20%20%20%20%20%20moves%20%3D%20moves.join('%2C').replace(%2F%2C%2C%2B%2Fg%2C%20'%2C').split('%2C')%0A%20%20%20%20%20%20%20%20var%20move%20%3D%20''%0A%0A%20%20%20%20%20%20%20%20var%20result%20%3D%20''%0A%0A%20%20%20%20%20%20%20%20for%20(var%20half_move%20%3D%200%3B%20half_move%20%3C%20moves.length%3B%20half_move%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20comment%20%3D%20decode_comment(moves%5Bhalf_move%5D)%0A%20%20%20%20%20%20%20%20%20%20if%20(comment%20!%3D%3D%20undefined)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20comments%5Bgenerate_fen()%5D%20%3D%20comment%0A%20%20%20%20%20%20%20%20%20%20%20%20continue%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20move%20%3D%20move_from_san(moves%5Bhalf_move%5D%2C%20sloppy)%0A%0A%20%20%20%20%20%20%20%20%20%20%2F*%20invalid%20move%20*%2F%0A%20%20%20%20%20%20%20%20%20%20if%20(move%20%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F*%20was%20the%20move%20an%20end%20of%20game%20marker%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(TERMINATION_MARKERS.indexOf(moves%5Bhalf_move%5D)%20%3E%20-1)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20result%20%3D%20moves%5Bhalf_move%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20false%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F*%20reset%20the%20end%20of%20game%20marker%20if%20making%20a%20valid%20move%20*%2F%0A%20%20%20%20%20%20%20%20%20%20%20%20result%20%3D%20''%0A%20%20%20%20%20%20%20%20%20%20%20%20make_move(move)%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20Per%20section%208.2.6%20of%20the%20PGN%20spec%2C%20the%20Result%20tag%20pair%20must%20match%0A%20%20%20%20%20%20%20%20%20*%20match%20the%20termination%20marker.%20Only%20do%20this%20when%20headers%20are%20present%2C%0A%20%20%20%20%20%20%20%20%20*%20but%20the%20result%20tag%20is%20missing%0A%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20if%20(result%20%26%26%20Object.keys(header).length%20%26%26%20!header%5B'Result'%5D)%20%7B%0A%20%20%20%20%20%20%20%20%20%20set_header(%5B'Result'%2C%20result%5D)%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20return%20true%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20header%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20set_header(arguments)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20ascii%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20ascii()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20turn%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20turn%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20move%3A%20function%20(move%2C%20options)%20%7B%0A%20%20%20%20%20%20%20%20%2F*%20The%20move%20function%20can%20be%20called%20with%20in%20the%20following%20parameters%3A%0A%20%20%20%20%20%20%20%20%20*%0A%20%20%20%20%20%20%20%20%20*%20.move('Nxb7')%20%20%20%20%20%20%3C-%20where%20'move'%20is%20a%20case-sensitive%20SAN%20string%0A%20%20%20%20%20%20%20%20%20*%0A%20%20%20%20%20%20%20%20%20*%20.move(%7B%20from%3A%20'h7'%2C%20%3C-%20where%20the%20'move'%20is%20a%20move%20object%20(additional%0A%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%20%20%20%20to%20%3A'h8'%2C%20%20%20%20%20%20fields%20are%20ignored)%0A%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%20%20%20%20promotion%3A%20'q'%2C%0A%20%20%20%20%20%20%20%20%20*%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%20*%2F%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20allow%20the%20user%20to%20specify%20the%20sloppy%20move%20parser%20to%20work%20around%20over%0A%20%20%20%20%20%20%20%20%2F%2F%20disambiguation%20bugs%20in%20Fritz%20and%20Chessbase%0A%20%20%20%20%20%20%20%20var%20sloppy%20%3D%0A%20%20%20%20%20%20%20%20%20%20typeof%20options%20!%3D%3D%20'undefined'%20%26%26%20'sloppy'%20in%20options%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20options.sloppy%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%20false%0A%0A%20%20%20%20%20%20%20%20var%20move_obj%20%3D%20null%0A%0A%20%20%20%20%20%20%20%20if%20(typeof%20move%20%3D%3D%3D%20'string')%20%7B%0A%20%20%20%20%20%20%20%20%20%20move_obj%20%3D%20move_from_san(move%2C%20sloppy)%0A%20%20%20%20%20%20%20%20%7D%20else%20if%20(typeof%20move%20%3D%3D%3D%20'object')%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20moves%20%3D%20generate_moves()%0A%0A%20%20%20%20%20%20%20%20%20%20%2F*%20convert%20the%20pretty%20move%20object%20to%20an%20ugly%20move%20object%20*%2F%0A%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%2C%20len%20%3D%20moves.length%3B%20i%20%3C%20len%3B%20i%2B%2B)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20move.from%20%3D%3D%3D%20algebraic(moves%5Bi%5D.from)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20move.to%20%3D%3D%3D%20algebraic(moves%5Bi%5D.to)%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20(!('promotion'%20in%20moves%5Bi%5D)%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20move.promotion%20%3D%3D%3D%20moves%5Bi%5D.promotion)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20move_obj%20%3D%20moves%5Bi%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20failed%20to%20find%20move%20*%2F%0A%20%20%20%20%20%20%20%20if%20(!move_obj)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20null%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%2F*%20need%20to%20make%20a%20copy%20of%20move%20because%20we%20can't%20generate%20SAN%20after%20the%0A%20%20%20%20%20%20%20%20%20*%20move%20is%20made%0A%20%20%20%20%20%20%20%20%20*%2F%0A%20%20%20%20%20%20%20%20var%20pretty_move%20%3D%20make_pretty(move_obj)%0A%0A%20%20%20%20%20%20%20%20make_move(move_obj)%0A%0A%20%20%20%20%20%20%20%20return%20pretty_move%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20undo%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20var%20move%20%3D%20undo_move()%0A%20%20%20%20%20%20%20%20return%20move%20%3F%20make_pretty(move)%20%3A%20null%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20clear%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20clear()%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20put%3A%20function%20(piece%2C%20square)%20%7B%0A%20%20%20%20%20%20%20%20return%20put(piece%2C%20square)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20get%3A%20function%20(square)%20%7B%0A%20%20%20%20%20%20%20%20return%20get(square)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20remove%3A%20function%20(square)%20%7B%0A%20%20%20%20%20%20%20%20return%20remove(square)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20perft%3A%20function%20(depth)%20%7B%0A%20%20%20%20%20%20%20%20return%20perft(depth)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20square_color%3A%20function%20(square)%20%7B%0A%20%20%20%20%20%20%20%20if%20(square%20in%20SQUARES)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20sq_0x88%20%3D%20SQUARES%5Bsquare%5D%0A%20%20%20%20%20%20%20%20%20%20return%20(rank(sq_0x88)%20%2B%20file(sq_0x88))%20%25%202%20%3D%3D%3D%200%20%3F%20'light'%20%3A%20'dark'%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20return%20null%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20history%3A%20function%20(options)%20%7B%0A%20%20%20%20%20%20%20%20var%20reversed_history%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20var%20move_history%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20var%20verbose%20%3D%0A%20%20%20%20%20%20%20%20%20%20typeof%20options%20!%3D%3D%20'undefined'%20%26%26%0A%20%20%20%20%20%20%20%20%20%20'verbose'%20in%20options%20%26%26%0A%20%20%20%20%20%20%20%20%20%20options.verbose%0A%0A%20%20%20%20%20%20%20%20while%20(history.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20reversed_history.push(undo_move())%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20while%20(reversed_history.length%20%3E%200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20move%20%3D%20reversed_history.pop()%0A%20%20%20%20%20%20%20%20%20%20if%20(verbose)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20move_history.push(make_pretty(move))%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20move_history.push(move_to_san(move%2C%20generate_moves(%7B%20legal%3A%20true%20%7D)))%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20make_move(move)%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20return%20move_history%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20get_comment%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20return%20comments%5Bgenerate_fen()%5D%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20set_comment%3A%20function%20(comment)%20%7B%0A%20%20%20%20%20%20%20%20comments%5Bgenerate_fen()%5D%20%3D%20comment.replace('%7B'%2C%20'%5B').replace('%7D'%2C%20'%5D')%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20delete_comment%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20var%20comment%20%3D%20comments%5Bgenerate_fen()%5D%0A%20%20%20%20%20%20%20%20delete%20comments%5Bgenerate_fen()%5D%0A%20%20%20%20%20%20%20%20return%20comment%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20get_comments%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20prune_comments()%0A%20%20%20%20%20%20%20%20return%20Object.keys(comments).map(function%20(fen)%20%7B%0A%20%20%20%20%20%20%20%20%20%20return%20%7B%20fen%3A%20fen%2C%20comment%3A%20comments%5Bfen%5D%20%7D%0A%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20delete_comments%3A%20function%20()%20%7B%0A%20%20%20%20%20%20%20%20prune_comments()%0A%20%20%20%20%20%20%20%20return%20Object.keys(comments).map(function%20(fen)%20%7B%0A%20%20%20%20%20%20%20%20%20%20var%20comment%20%3D%20comments%5Bfen%5D%0A%20%20%20%20%20%20%20%20%20%20delete%20comments%5Bfen%5D%0A%20%20%20%20%20%20%20%20%20%20return%20%7B%20fen%3A%20fen%2C%20comment%3A%20comment%20%7D%0A%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%7D%0A%20%20%7D%0A%0A%20%20%2F*%20export%20Chess%20object%20if%20using%20node%20or%20any%20other%20CommonJS%20compatible%0A%20%20%20*%20environment%20*%2F%0A%20%20if%20(typeof%20exports%20!%3D%3D%20'undefined')%20exports.Chess%20%3D%20Chess%0A%20%20%2F*%20export%20Chess%20object%20for%20any%20RequireJS%20compatible%20environment%20*%2F%0A%20%20if%20(typeof%20define%20!%3D%3D%20'undefined')%0A%20%20%20%20define(function%20()%20%7B%0A%20%20%20%20%20%20return%20Chess%0A%20%20%20%20%7D)%0A%0A%0A%0Aconsole.log('Hello')%0A%0Avar%20board_background%20%3D%20%60%0A%3Cdiv%20class%3D%22board%22%3E%0A%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22sq%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%60%0A%0Avar%20html_boards%20%3D%20%7Bw%20%3A%20%60%0A%3Cdiv%20id%3D%22Realboard%22%20class%3D%22board%22%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbR.svg%22%3E%0A%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbN.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbB.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbQ.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbK.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbB.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbN.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbR.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwR.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwN.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwB.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwQ.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwK.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwB.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwN.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwR.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%60%2C%0Ab%3A%20%60%0A%3Cdiv%20id%3D%22Realboard%22%20class%3D%22board%22%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwR.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwN.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwB.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwQ.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwK.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwB.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwN.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h1%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwR.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h2%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FwP.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h3%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h4%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h5%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h6%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fx.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%0A%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h7%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2Fbp.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%0A%3Cdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22a8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbR.svg%22%3E%0A%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22b8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbN.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22c8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbB.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22d8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbQ.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22e8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbK.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22f8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbB.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22g8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbN.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20id%3D%22h8%22%20class%3D%22sq%22%3E%0A%20%20%20%20%20%20%20%20%3Cdiv%20class%3D%22mind%22%3E%3C%2Fdiv%3E%0A%20%20%20%20%20%20%20%20%3Cimg%20src%3D%22cburnett%2FbR.svg%22%3E%0A%20%20%20%20%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%0A%3C%2Fdiv%3E%60%7D%0A%0Afunction%20new_game(token%2CgameId)%7B%0A%0A%20%20%20%20var%20headers%20%3D%20%7B%0A%20%20%20%20%20%20%20%20Authorization%3A%20'Bearer%20'%20%2B%20token%0A%20%20%20%20%7D%3B%0A%0A%20%20%20%20function%20get(url)%7B%0A%20%20%20%20%20%20%20%20%2F%2Fglobal%20headers%0A%20%20%20%20%20%20%20%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%0A%20%20%20%20%20%20%20%20xhr.open(%22GET%22%2C%20url%2C%20true)%3B%0A%20%20%20%20%20%20%20%20xhr.setRequestHeader('Authorization'%2C%20'Bearer%20'%2Btoken)%3B%0A%0A%20%20%20%20%20%20%20%20xhr.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20if%20(this.readyState%20%3D%3D%204%20%26%26%20this.status%20%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20console.log(this.responseText)%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20xhr.send()%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20post(url)%7B%0A%20%20%20%20%20%20%20%20%2F%2Fglobal%20headers%0A%20%20%20%20%20%20%20%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%0A%20%20%20%20%20%20%20%20xhr.open(%22POST%22%2C%20url%2C%20true)%3B%0A%20%20%20%20%20%20%20%20xhr.setRequestHeader('Authorization'%2C%20'Bearer%20'%2Btoken)%3B%0A%0A%20%20%20%20%20%20%20%20xhr.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20console.log(xhr.response)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20xhr.send()%0A%20%20%20%20%7D%0A%0A%0A%0A%0A%20%20%20%20%2F%2Fvar%20gameId%20%3D%20'CpOYtk26'%3B%0A%20%20%20%20var%20gameUserColor%20%3D%20''%3B%0A%20%20%20%20var%20gameWBCounter%20%3D%20'w'%0A%20%20%20%20var%20gameWBCounterNot%20%3D%20'b'%0A%20%20%20%20%2F%2F%20var%20move%20%3D%20''%3B%0A%20%20%20%20%2F%2Fvar%20token%20%3D%20'lip_WsYICFZtoLdWaOmIlNmo'%3B%0A%20%20%20%20%2F%2F%20get%0A%20%20%20%20var%20stream_url%20%3D%20%22https%3A%2F%2Flichess.org%2Fapi%2Fboard%2Fgame%2Fstream%2F%22%2BgameId%3B%0A%0A%20%20%20%20%2F%2F%20post%0A%20%20%20%20%2F%2Fvar%20move_url%20%3D%20%22https%3A%2F%2Flichess.org%2Fapi%2Fboard%2Fgame%2F%22%2BgameId%2B%22%2Fmove%2F%22%2Bmove%3B%0A%0A%20%20%20%20var%20abort_url%20%3D%20%22https%3A%2F%2Flichess.org%2Fapi%2Fboard%2Fgame%2F%22%2BgameId%2B%22%2Fabort%22%3B%0A%0A%20%20%20%20var%20resign_url%20%3D%20%22https%3A%2F%2Flichess.org%2Fapi%2Fboard%2Fgame%2F%22%2BgameId%2B%22%2Fresign%22%3B%0A%0A%0A%20%20%20%20function%20xhr_req(method%2Curl%2Casynchronous%2Ccallback)%7B%0A%20%20%20%20%20%20%20%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%0A%20%20%20%20%20%20%20%20xhr.open(method%2C%20url%2C%20asynchronous)%3B%0A%20%20%20%20%20%20%20%20xhr.setRequestHeader('Authorization'%2C%20'Bearer%20'%2Btoken)%3B%0A%0A%20%20%20%20%20%20%20%20xhr.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%20%20%20%20if%20(this.readyState%20%3D%3D%204%20%26%26%20this.status%20%3D%3D%20200)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20callback(JSON.parse(this.response))%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20xhr.send()%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20sync_get_user()%7B%0A%20%20%20%20%20%20%20%20xhr_req(%22GET%22%2C'https%3A%2F%2Flichess.org%2Fapi%2Faccount'%2Cfalse%2C%20function(j)%7B%0A%20%20%20%20%20%20%20%20user%20%3D%20j%0A%20%20%20%20%20%20%20%20console.log('user'%2Cj)%0A%0A%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20sync_get_open_games()%7B%0A%20%20%20%20%20%20%20%20xhr_req(%22GET%22%2C'https%3A%2F%2Flichess.org%2Fapi%2Faccount%2Fplaying'%2Cfalse%2C%20function(j)%7B%0A%20%20%20%20%20%20%20%20open_games%20%3D%20j.nowPlaying%0A%20%20%20%20%20%20%20%20console.log('games'%2Cj.nowPlaying)%0A%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20user%20%3D%20%7B%7D%0A%20%20%20%20var%20open_games%20%3D%20%5B%5D%0A%20%20%20%20sync_get_user()%0A%20%20%20%20sync_get_open_games()%0A%0A%0A%0A%0A%0A%20%20%20%20function%20board_move(move)%7B%0A%20%20%20%20%20%20%20%20%2F%2Fhttps%3A%2F%2Flichess.org%2Fapi%23operation%2FboardGameMove%0A%20%20%20%20%20%20%20%20%2F%2F%20gameId%0A%20%20%20%20%20%20%20%20%2F%2F%20%20%20required%0A%20%20%20%20%20%20%20%20%2F%2F%20%20%20string%0A%20%20%20%20%20%20%20%20%2F%2F%20%20%20Example%3A%205IrD6Gzz%0A%20%20%20%20%20%20%20%20%2F%2F%20move%0A%20%20%20%20%20%20%20%20%2F%2F%20%20%20required%0A%20%20%20%20%20%20%20%20%2F%2F%20%20%20string%0A%20%20%20%20%20%20%20%20%2F%2F%20%20%20Example%3A%20e2e4%0A%20%20%20%20%20%20%20%20%2F%2F%20The%20move%20to%20play%2C%20in%20UCI%20format%0A%20%20%20%20%20%20%20%20var%20move_url%20%3D%20%22https%3A%2F%2Flichess.org%2Fapi%2Fboard%2Fgame%2F%22%2BgameId%2B%22%2Fmove%2F%22%2Bmove%3B%0A%20%20%20%20%20%20%20%20post(move_url)%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20gv_game%20%3D%20''%0A%20%20%20%20var%20game_state%20%3D%20%7B%7D%0A%0A%0A%20%20%20%20function%20move_enemy(move)%7B%0A%0A%20%20%20%20%20%20%20%20prepare_moves_html_board(move.slice(0%2C-2))%0A%20%20%20%20%20%20%20%20move_html_board(document.getElementById(move.slice(2))%2Cfalse)%0A%20%20%20%20%7D%0A%0A%20%20%20%20var%20movestr%20%3D%20%22%22%0A%20%20%20%20function%20moves_to_board(moves%2Cinstid)%7B%0A%20%20%20%20%20%20%20%20var%20new_moves%20%3D%20moves.slice(movestr.length).split('%20')%0A%20%20%20%20%20%20%20%20movestr%20%3D%20moves%0A%0A%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D0%3Bi%3Cnew_moves.length%3Bi%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(new_moves%5Bi%5D.length%3E0)%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20move_enemy(new_moves%5Bi%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20var%20alreadyread%20%3D%200%3B%0A%20%20%20%20var%20active_instance%20%3D%20'A'%0A%20%20%20%20var%20old_instance%20%3D%20'B'%0A%20%20%20%20var%20new_instance%20%3D%20'A'%0A%20%20%20%20var%20set_new_instance%20%3D%20false%0A%20%20%20%20function%20create_new_request(instid)%7B%0A%20%20%20%20%20%20%20%20%2F%2F%20console.log('create%20new%20request')%0A%20%20%20%20%20%20%20%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%0A%20%20%20%20%20%20%20%20xhr.open('GET'%2C%20stream_url%2C%20headers%3Dheaders)%3B%0A%20%20%20%20%20%20%20%20%2F%2F%20xhr.responseType%20%3D%22moz-chunked-text%22%0A%20%20%20%20%20%20%20%20xhr.setRequestHeader('Authorization'%2C%20'Bearer%20'%2Btoken)%3B%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20xhr.responseType%20%3D%20'blob'%3B%20%25systemroot%25%5Csystem32%5Cf12%5CIEChooser.exe%0A%0A%20%20%20%20%20%20%20%20xhr.onprogress%20%3D%20function(r)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20console.log(instid%2C%20alreadyread)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(active_instance%20!%3D%20instid)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log('not%20active%20inst'%2Cactive_instance%2Cset_new_instance)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(set_new_instance)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log('setnewinst'%2Cinstid)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20active_instance%20%3D%20instid%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set_new_instance%20%3D%20false%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alreadyread%20%3D%200%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%20%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xhr.abort()%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xhr.onprogress%20%3D%20null%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20l%20%3D%20r.target.response.slice(alreadyread).split(%22%7D%5Cn%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20alreadyread%20%3D%20r.target.response.length%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20r.target.response%20%3D''%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3Bi%3Cl.length%3Bi%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(l%5Bi%5D.length%3E9)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%20console.log('b2%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D'%2Cl%5Bi%5D%2B'%7D')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20j%20%3D%20JSON.parse(l%5Bi%5D%2B'%7D')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(j)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(j.type%20%3D%3D'gameFull')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(j.id%20%3D%3D%20gameId)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if(j.white.hasOwnProperty('id')%26%26%20j.white.id%20%3D%3D%20user.id)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gameUserColor%20%3D%20'w'%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gameUserColor%20%3D%20'b'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set_up_board(gameUserColor)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20moves_to_board(j.state.moves%2Cinstid)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alert('an%20error%20occured%20fetching%20the%20game%20state%2C%20please%20reload%20the%20site')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20console.log(j)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20console.log('full%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D'%2Cinstid%2Cj.state.moves)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if(j.type%20%3D%3D%20'gameState')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20console.log(j)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20moves_to_board(j.moves%2Cinstid)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20console.log('state%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D'%2Cinstid%2Cj.moves)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(alreadyread%3E10000%20%26%26%20!(set_new_instance)%20%26%26%20old_instance%20!%3Dinstid)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20new_id%20%3D%20'A'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20old_instance%20%3D%20instid%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(instid%20%3D%3D%20'A')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20new_id%20%3D%20'B'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20create_new_request(new_id)%20%2F%2F%20probably%20not%20good%20for%20garbage%20collect%20but%20so%20alreadyread%20stays%20small%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20set_new_instance%20%3D%20true%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20xhr.send()%3B%0A%20%20%20%20%7D%0A%20%20%20%20create_new_request(active_instance)%0A%0A%0A%20%20%20%20%2F%2F%20%3E%3E%3E%20board_driver.js%20%3C%3C%3C%0A%0A%20%20%20%20const%20chess%20%3D%20new%20Chess()%0A%0A%20%20%20%20%2F%2F%20chess.move('f4')%0A%20%20%20%20%2F%2F%20console.log(chess.ascii())%0A%20%20%20%20%2F%2F%20chess.move('e2e4'%2C%20%7B%20sloppy%3A%20true%20%7D)%0A%20%20%20%20%2F%2F%20chess.moves(%7B%20square%3A%20'e2'%20%7D)%0A%0A%0A%20%20%20%20%2F%2F%20var%20rows%20%3D%20document.getElementsByClassName(%22board%22)%5B0%5D.children%0A%0A%0A%20%20%20%20var%20empty_src%20%3D%20'cburnett%2Fx.svg'%0A%0A%20%20%20%20var%20player_color%20%3D%20'w'%3B%0A%0A%20%20%20%20var%20allsquares_ids%20%3D%20%5B%22a1%22%2C%22b1%22%2C%22c1%22%2C%22d1%22%2C%22e1%22%2C%22f1%22%2C%22g1%22%2C%22h1%22%2C%22a2%22%2C%22b2%22%2C%22c2%22%2C%22d2%22%2C%22e2%22%2C%22f2%22%2C%22g2%22%2C%22h2%22%2C%22a3%22%2C%22b3%22%2C%22c3%22%2C%22d3%22%2C%22e3%22%2C%22f3%22%2C%22g3%22%2C%22h3%22%2C%22a4%22%2C%22b4%22%2C%22c4%22%2C%22d4%22%2C%22e4%22%2C%22f4%22%2C%22g4%22%2C%22h4%22%2C%22a5%22%2C%22b5%22%2C%22c5%22%2C%22d5%22%2C%22e5%22%2C%22f5%22%2C%22g5%22%2C%22h5%22%2C%22a6%22%2C%22b6%22%2C%22c6%22%2C%22d6%22%2C%22e6%22%2C%22f6%22%2C%22g6%22%2C%22h6%22%2C%22a7%22%2C%22b7%22%2C%22c7%22%2C%22d7%22%2C%22e7%22%2C%22f7%22%2C%22g7%22%2C%22h7%22%2C%22a8%22%2C%22b8%22%2C%22c8%22%2C%22d8%22%2C%22e8%22%2C%22f8%22%2C%22g8%22%2C%22h8%22%5D%0A%20%20%20%20var%20all_squares%20%3D%20%7B%7D%0A%20%20%20%20var%20last_allowed%20%3D%20%5B%5D%0A%20%20%20%20var%20last_base%20%3D%20%7Bw%3Adocument.body%2Cb%3Adocument.body%7D%0A%20%20%20%20var%20last_enemy_moved%20%3D%20document.body%0A%0A%0A%20%20%20%20function%20set_up_board(player_color)%7B%0A%20%20%20%20%20%20%20%20var%20full_board%20%3D%20document.getElementById('Fullboard')%0A%20%20%20%20%20%20%20%20full_board.innerHTML%20%3D%20null%0A%20%20%20%20%20%20%20%20full_board.innerHTML%20%2B%3D%20board_background%0A%20%20%20%20%20%20%20%20full_board.innerHTML%20%2B%3D%20html_boards%5Bplayer_color%5D%0A%0A%20%20%20%20%20%20%20%20for(var%20i%20%3D%200%3Bi%3Callsquares_ids.length%3Bi%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20e%20%3D%20document.getElementById(allsquares_ids%5Bi%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20all_squares%5Ballsquares_ids%5Bi%5D%5D%20%3D%20e%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20c%20%3D%20chess.get(allsquares_ids%5Bi%5D)%0A%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20e.setAttribute('data-frw'%2C0)%0A%20%20%20%20%20%20%20%20%20%20%20%20e.setAttribute('data-frb'%2C0)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(%20c!%3D%20null%20%20%26%26%20%20c.color%3D%3D'w')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20console.log(chess.get(allsquares_ids%5Bi%5D))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e.setAttribute('data-frw'%2C1)%0A%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%20if%20(%20c!%3D%20null%20%20%26%26%20%20c.color%3D%3D'b')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e.setAttribute('data-frb'%2C1)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20e.setAttribute('data-tow'%2C0)%0A%20%20%20%20%20%20%20%20%20%20%20%20e.setAttribute('data-tob'%2C0)%0A%20%20%20%20%20%20%20%20%20%20%20%20e.addEventListener('click'%2Cfunction(e)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20square_click(e.target)%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%0A%0A%20%20%20%20var%20base_click_id%20%3D%20''%0A%20%20%20%20%2F%2F%20used%20for%20own%20move%20and%20other%20side%20move%0A%20%20%20%20function%20prepare_moves_html_board(id)%7B%0A%20%20%20%20%20%20%20%20console.log('%3D%3D%20prepare_moves%20%3D%3D%20'%2Cid%2C%20gameWBCounter%2Cchess.get(id))%0A%20%20%20%20%20%20%20%20var%20d_to%20%3D%20'data-to'%2BgameWBCounter%0A%20%20%20%20%20%20%20%20var%20d_last_to%20%3D%20'data-tow'%0A%20%20%20%20%20%20%20%20if(gameWBCounter%3D%3D'w')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20d_last_to%20%3D%20'data-tob'%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20var%20d_flag%20%3D%20'data-flg'%2BgameWBCounter%0A%0A%20%20%20%20%20%20%20%20base_click_id%20%3D%20id%0A%20%20%20%20%20%20%20%20console.log('aa'%2Clast_base)%0A%20%20%20%20%20%20%20%20%2F%2Fhandle%20css%0A%0A%20%20%20%20%20%20%20%20if%20(gameWBCounter%20!%3D%20gameUserColor)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20last_base%5BgameWBCounterNot%5D.classList.remove('basepiece')%0A%20%20%20%20%20%20%20%20%20%20%20%20last_base%5BgameWBCounterNot%5D.classList.remove('enemymove')%0A%20%20%20%20%20%20%20%20%20%20%20%20last_base%5BgameWBCounter%5D.classList.remove('enemymove')%0A%20%20%20%20%20%20%20%20%20%20%20%20last_base%5BgameWBCounter%5D%20%3D%20document.getElementById(id)%0A%20%20%20%20%20%20%20%20%20%20%20%20last_base%5BgameWBCounter%5D.classList.add('enemymove')%0A%20%20%20%20%20%20%20%20%7Delse%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20last_base%5BgameWBCounter%5D.classList.remove('basepiece')%0A%20%20%20%20%20%20%20%20%20%20%20%20last_base%5BgameWBCounter%5D%20%3D%20document.getElementById(id)%0A%20%20%20%20%20%20%20%20%20%20%20%20last_base%5BgameWBCounter%5D.classList.add('basepiece')%0A%20%20%20%20%20%20%20%20%7D%0A%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20allowed_moves%20%3D%20chess.moves(%7B%20square%3A%20id%2Cverbose%3A%20true%20%7D)%0A%20%20%20%20%20%20%20%20%20%20%20%20console.log('allowed%20moves%20'%2Callowed_moves)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%3Clast_allowed.length%3Bi%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20%3D%20last_allowed%5Bi%5D%5B'to'%5D.slice(-2)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20e_to%20%3D%20all_squares%5Bs%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e_to.setAttribute(d_to%2C0)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20e_to.setAttribute('data-cap'%2Clast_allowed%5Bi%5D%5B'san'%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e_to.classList.remove('moveto')%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20last_allowed%20%3D%20allowed_moves.slice()%3B%20%2F%2Fcloning%20needed%0A%20%20%20%20%20%20%20%20%20%20%20%20console.log(last_allowed)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%3Callowed_moves.length%3Bi%2B%2B)%7B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20%3D%20allowed_moves%5Bi%5D%5B'to'%5D.slice(-2)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20e_to%20%3D%20all_squares%5Bs%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e_to.setAttribute(d_to%2C1)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20e_to.setAttribute('data-san'%2Callowed_moves%5Bi%5D%5B'san'%5D.slice(-2))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20flg%20%3D%20allowed_moves%5Bi%5D%5B'flags'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e_to.setAttribute(d_flag%2Cflg)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(flg%20%3D%3D%20'k'%20%7C%7C%20flg%20%3D%3D'q')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rook_id%20%3D%20''%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(flg%20%3D%3D%20'k')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook_id%20%3D%20'h'%2Bid.slice(1)%0A%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%20if(flg%20%3D%3D'q')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook_id%20%3D%20'a'%2Bid.slice(1)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rook%20%3D%20%20all_squares%5Brook_id%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook.classList.add('rochadepiece')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook.setAttribute(d_to%2C1)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook.setAttribute(d_flag%2Cflg)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20last_allowed.push(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%20%3A%20gameWBCounter%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20from%20%3A%20id%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20piece%20%3A%20''%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20flags%20%3A%20flg%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20san%20%3A%20''%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20to%20%3A%20rook_id%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e_to.classList.add('moveto')%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20function%20move_html_board(e%2Cfrom_browser%20%3D%20false)%7B%0A%20%20%20%20%20%20%20%20console.log('%3D%3D%20move_board%20%3D%3D%20'%2Ce%2C%20from_browser)%0A%20%20%20%20%20%20%20%20var%20d_from%20%3D%20'data-fr'%2BgameWBCounter%0A%20%20%20%20%20%20%20%20var%20d_to%20%3D%20'data-to'%2BgameWBCounter%0A%20%20%20%20%20%20%20%20var%20d_flag%20%3D%20'data-flg'%2BgameWBCounter%0A%0A%20%20%20%20%20%20%20%20for%20(var%20i%20%3D%200%3B%20i%3Clast_allowed.length%3Bi%2B%2B)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20s%20%3D%20last_allowed%5Bi%5D%5B'to'%5D.slice(-2)%0A%20%20%20%20%20%20%20%20%20%20%20%20var%20e_to%20%3D%20all_squares%5Bs%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20e_to.setAttribute(d_to%2C0)%0A%20%20%20%20%20%20%20%20%20%20%20%20e_to.classList.remove('moveto')%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2F%20var%20temp_src%20%3D%20e.children%5B1%5D.src%0A%20%20%20%20%20%20%20%20var%20base_elem%20%3D%20all_squares%5Bbase_click_id%5D%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20console.log(e.children%5B1%5D.src)%0A%20%20%20%20%20%20%20%20var%20flg%20%3D%20e.getAttribute(d_flag)%0A%20%20%20%20%20%20%20%20%2F%2Fconsole.log('enpassant'%2Ce.id.slice(0%2C1)%2Bbase_click_id.slice(-1))%0A%20%20%20%20%20%20%20%20if%20(flg%3D%3D'e')%20%2F%2Fen%20passant%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20all_squares%5Be.id.slice(0%2C1)%2Bbase_click_id.slice(-1)%5D.children%5B1%5D.src%20%3D%20empty_src%0A%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%20%20%20base_elem.children%5B1%5D.src%20%3D%20empty_src%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20base_elem.setAttribute('data-frb'%2C0)%0A%20%20%20%20%20%20%20%20%20%20%20%20base_elem.setAttribute('data-frw'%2C0)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20if%20(flg%20%3D%3D%20'p')%20%2F%2F%20promotion%0A%20%20%20%20%20%20%20%20%7B%0A%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20if%20(flg%20%3D%3D%20'k'%7C%7C%20flg%3D%3D'q')%20%2F%2F%20%20castle%20kingside%20queenside%0A%20%20%20%20%20%20%20%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20console.log('rochade'%2Cflg)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20r0%20%3D%20''%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r1%20%3D%20''%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20k1%20%3D%20''%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(flg%20%3D%3D%20'k')%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r0%20%3D%20'h'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r1%20%3D%20'f'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20k1%20%3D%20'g'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7Delse%7B%20%2F%2Fq%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r0%20%3D%20'a'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20r1%20%3D%20'd'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20k1%20%3D%20'c'%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20bw%20%3D%20base_click_id.slice(1)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rook0%20%3D%20all_squares%5Br0%2Bbw%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook0.setAttribute(d_from%2C0)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook0.classList.remove('rochadepiece')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(r1%2Bbw)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20rook1%20%3D%20all_squares%5Br1%2Bbw%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook1.setAttribute(d_from%2C1)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2Fchange%20images%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2Frook%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook1.children%5B1%5D.src%20%3D%20rook0.children%5B1%5D.src%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20rook0.children%5B1%5D.src%20%3D%20empty_src%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20%2F%2Fking%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20base_elem.children%5B1%5D.src%20%3D%20empty_src%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%2F%2F%20base_elem.setAttribute(d_from%2C0)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e%20%3D%20all_squares%5Bk1%2Bbw%5D%20%2F%2Fking1%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20console.log(rook0%2Crook1%2Call_squares%5Bbase_click_id%5D%2Ce)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20if(flg%20%3D%3D%20'c')%20%2F%2F%20normal%20capture%0A%20%20%20%20%20%20%20%20%7B%0A%0A%20%20%20%20%20%20%20%20%7Delse%7B%0A%0A%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2Fenemy%20move%20indicator%0A%20%20%20%20%20%20%20%20if(gameWBCounter%20!%3D%20gameUserColor)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20last_enemy_moved.classList.remove('enemymove')%0A%20%20%20%20%20%20%20%20%20%20%20%20e.classList.add('enemymove')%0A%20%20%20%20%20%20%20%20%20%20%20%20last_enemy_moved%20%3D%20e%0A%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20e.children%5B1%5D.src%20%3D%20base_elem.children%5B1%5D.src%0A%20%20%20%20%20%20%20%20base_elem.children%5B1%5D.src%20%3D%20empty_src%0A%20%20%20%20%20%20%20%20base_elem.setAttribute(d_from%2C0)%0A%0A%0A%20%20%20%20%20%20%20%20e.setAttribute('data-fr'%2BgameWBCounterNot%2C0)%0A%20%20%20%20%20%20%20%20e.setAttribute(d_from%2C1)%0A%0A%20%20%20%20%20%20%20%20chess.move(base_click_id%2Be.id%2C%20%7B%20sloppy%3A%20true%20%7D)%0A%20%20%20%20%20%20%20%20console.log(chess.ascii())%0A%0A%20%20%20%20%20%20%20%20%2F%2F%20lichess%20api%20post%20new%20move%0A%20%20%20%20%20%20%20%20if(gameWBCounter%3D%3DgameUserColor%20%26%26%20from_browser)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20movestr%20%2B%3D%20%22%20%22%2Bbase_click_id%2Be.id%0A%20%20%20%20%20%20%20%20%20%20%20%20board_move(base_click_id%2Be.id)%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%2F%2F%20switch%20turn%20w%20%3C-%3E%20b%0A%20%20%20%20%20%20%20%20var%20temp_c%20%3D%20gameWBCounter%3B%0A%20%20%20%20%20%20%20%20gameWBCounter%20%3D%20gameWBCounterNot%0A%20%20%20%20%20%20%20%20gameWBCounterNot%20%3D%20temp_c%0A%0A%0A%20%20%20%20%7D%0A%0A%20%20%20%20function%20square_click(e)%7B%0A%20%20%20%20%2F%2Forder%20switched%20for%20rochade%0A%20%20%20%20if%20(e.getAttribute('data-to'%2BgameUserColor)%20%3D%3D%201%20%26%26%20base_click_id.length%20!%3D%200%20)%7B%0A%0A%20%20%20%20%20%20%20%20move_html_board(e%2C%20true)%0A%0A%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20if%20(e.getAttribute('data-fr'%2BgameUserColor)%20%3D%3D%201)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20prepare_moves_html_board(e.id)%0A%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%0A%0A%20%20%20%20%2F%2F%20var%20reader%20%3D%20new%20MSStreamReader()%3B%0A%0A%0A%0A%20%20%20%20%2F%2F%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%0A%0A%20%20%20%20%2F%2F%20xhr.open('GET'%2C%20stream_url)%3B%0A%20%20%20%20%2F%2F%20xhr.setRequestHeader('Authorization'%2C%20'Bearer%20'%2Btoken)%3B%0A%20%20%20%20%2F%2F%20xhr.seenBytes%20%3D%200%3B%0A%0A%20%20%20%20%2F%2F%20xhr.onload%20%3D%20function(e)%7B%0A%20%20%20%20%2F%2F%20%20%20console.log(e.repsonse)%0A%20%20%20%20%2F%2F%20%7D%0A%20%20%20%20%2F%2F%20xhr.onreadystatechange%20%3D%20function()%20%7B%0A%20%20%20%20%2F%2F%20%20%20console.log(%22state%20change..%20state%3A%20%22%2B%20xhr.readyState)%3B%0A%0A%20%20%20%20%2F%2F%20%20%20if(xhr.readyState%20%3D%3D%203)%20%7B%0A%20%20%20%20%2F%2F%20%20%20%20%20var%20newData%20%3D%20xhr.response.substr(xhr.seenBytes)%3B%0A%20%20%20%20%2F%2F%20%20%20%20%20console.log(%22newData%3A%20%3C%3C%22%20%2BnewData%2B%20%22%3E%3E%22)%3B%0A%20%20%20%20%2F%2F%20%20%20%20%20document.body.innerHTML%20%2B%3D%20%22New%20data%3A%20%3C%3C%22%20%2BnewData%2B%20%22%3E%3E%3Cbr%20%2F%3E%22%3B%0A%0A%20%20%20%20%2F%2F%20%20%20%20%20xhr.seenBytes%20%3D%20xhr.responseText.length%3B%0A%20%20%20%20%2F%2F%20%20%20%20%20console.log(%22seenBytes%3A%20%22%20%2Bxhr.seenBytes)%3B%0A%20%20%20%20%2F%2F%20%20%20%7D%0A%20%20%20%20%2F%2F%20%7D%3B%0A%0A%20%20%20%20%2F%2F%20xhr.onreadystatechange%20%3D%20function%20()%20%7B%0A%20%20%20%20%2F%2F%20%20%20console.log(xhr.status)%0A%20%20%20%20%2F%2F%20%20%20%20%20if%20(xhr.status%20%3D%3D%3D%20200)%20%7B%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20var%20blob%20%3D%20this.response%3B%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20console.log(this)%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%2F%2F%20reader.readAsArrayBuffer(blob)%3B%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%2F%2F%20reader.read()%3B%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%2F%2F%20var%20value%20%3D%20new%20TextDecoder().decode(value)%3B%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%2F%2F%20console.log('hi')%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%2F%2F%20if%20(value.length%20%3E1)%7B%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%20%20%20value%20%3D%20JSON.parse(value)%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%20%20%20console.log(value)%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%2F%2F%20%20%20%20%20%7D%0A%20%20%20%20%2F%2F%20%7D%3B%0A%0A%20%20%20%20%2F%2F%20xhr.onprogress%20%3D%20function(e)%7B%0A%20%20%20%20%2F%2F%20%20%20%20%20console.log(e)%0A%20%20%20%20%2F%2F%20%7D%0A%20%20%20%20%2F%2F%20xhr.send()%3B%0A%0A%20%20%20%20%2F%2F%20function%20readStream(stream)%20%7B%0A%20%20%20%20%2F%2F%20%20%20var%20reader%20%3D%20stream.getReader()%3B%0A%0A%20%20%20%20%2F%2F%20%20%20reader.read().then(function%20c(%7B%20done%2C%20value%20%7D)%20%7B%0A%20%20%20%20%2F%2F%20%20%20%20%20var%20value%20%3D%20new%20TextDecoder().decode(value)%3B%0A%20%20%20%20%2F%2F%20%20%20%20%20console.log(value)%0A%20%20%20%20%2F%2F%20%20%20%20%20console.log(value.length)%0A%20%20%20%20%2F%2F%20%20%20%20%20if%20(value.length%20%3E1)%7B%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20value%20%3D%20JSON.parse(value)%0A%20%20%20%20%2F%2F%20%20%20%20%20%20%20%20%20console.log(value)%0A%20%20%20%20%2F%2F%20%20%20%20%20%7D%0A%0A%0A%20%20%20%20%2F%2F%20%20%20%20%20return%20reader.read().then(c)%3B%0A%20%20%20%20%2F%2F%20%20%20%7D)%3B%0A%20%20%20%20%2F%2F%20%7D%0A%0A%0A%0A%0A%0A%7D%0A%0Avar%20token%20%3D%20'lip_WsYICFZtoLdWaOmIlNmo'%3B%0Anew_game(token%2C'd1qH85Sx')

</body>
</html>